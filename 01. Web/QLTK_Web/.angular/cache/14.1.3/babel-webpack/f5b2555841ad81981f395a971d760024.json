{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/gapi/service/file-repository.service\";\nimport * as i2 from \"src/app/gapi/model/fileInfo\";\nimport * as i3 from \"../../services/module-tab-design-document.service\";\nimport * as i4 from \"src/app/shared\";\nimport * as i5 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i6 from \"src/app/gapi/service/gapi.session\";\nexport let ModuleChooseFileDesignDocumentComponent = /*#__PURE__*/(() => {\n  class ModuleChooseFileDesignDocumentComponent {\n    constructor(fileService, fileInfo, designDocumentService, messageService, activeModal, gapiservice) {\n      this.fileService = fileService;\n      this.fileInfo = fileInfo;\n      this.designDocumentService = designDocumentService;\n      this.messageService = messageService;\n      this.activeModal = activeModal;\n      this.gapiservice = gapiservice;\n      this.files = [];\n      this.listFile = [];\n      this.listFolder = [];\n      this.fileModel = {\n        Id: '',\n        ModuleId: '',\n        ParentId: '',\n        Name: '',\n        Path: '',\n        FileType: '',\n        FileSize: 0,\n        Type: 0,\n        Blob: File\n      };\n      this.importModel = {\n        ListFile: [],\n        DesignType: ''\n      };\n    }\n\n    ngOnInit() {}\n\n    dragover(event) {\n      event.preventDefault();\n    }\n\n    drop(event) {\n      if (this.importModel.DesignType != '') {\n        const items = event.dataTransfer.items;\n\n        for (let i = 0; i < items.length; i++) {\n          const entry = items[i].webkitGetAsEntry();\n          this.scanFiles(entry);\n          this.uploadFolder(0);\n        }\n      } else {\n        this.messageService.showMessage(\"Bạn chưa chọn loại tài liệu thiết kế!\");\n      }\n    }\n\n    scanFiles(item) {\n      if (item.isDirectory) {\n        var fileM = Object.assign({}, this.fileModel);\n        fileM.Name = item.name;\n        fileM.ModuleId = this.ModuleId;\n        fileM.Path = item.fullPath;\n        fileM.ParentId = item.fullPath.replace('/' + item.name, '');\n        fileM.Type = 0;\n        this.listFile.push(fileM);\n        var directoryReader = item.createReader();\n        directoryReader.readEntries(entries => {\n          entries.forEach(entry => this.readEntry(entry));\n        });\n      } else {\n        return new Promise((resolve, reject) => {\n          item.file(file => {\n            resolve(file);\n            var fileM = Object.assign({}, this.fileModel);\n            fileM.Name = item.name;\n            fileM.ModuleId = this.ModuleId;\n            fileM.ParentId = item.fullPath.replace('/' + item.name, '');\n            fileM.Path = item.fullPath;\n            fileM.Type = 1;\n            fileM.Blob = file;\n            this.listFile.push(fileM);\n          }, err => {\n            reject(err);\n          });\n        });\n      }\n    }\n\n    readEntry(entry) {\n      this.scanFiles(entry);\n    }\n\n    uploadFolder(index) {\n      if (this.gapiservice.isSignedIn) {\n        var googleId = 'root';\n\n        if (index < this.listFile.length) {\n          for (let i = 0; i < this.listFile.length; i++) {\n            if (this.listFile[i].Path == this.listFile[index].ParentId) {\n              googleId = this.listFile[i].Id;\n              break;\n            }\n          }\n\n          if (this.listFile[index].Type == 0) {\n            this.fileService.create(googleId, this.listFile[index].Name).then(res => {\n              this.listFile[index].Id = res.Id;\n\n              if (googleId != 'root') {\n                this.listFile[index].ParentId = googleId;\n              }\n\n              this.listFile[index].FileType = \"2\";\n              this.awaitUploadFolder(index + 1);\n            });\n          } else {\n            this.listFile[index].ParentId = googleId;\n            this.fileInfo.Name = this.listFile[index].Name;\n            this.fileInfo.Blob = this.listFile[index].Blob;\n            this.uploadFile(googleId, this.fileInfo, index);\n          }\n        } else {\n          this.importModel.ListFile = this.listFile;\n          this.designDocumentService.uploadDesignDocument(this.importModel).subscribe(data => {\n            this.messageService.showSuccess(\"Upload file thành công!\");\n            this.closeModal();\n          }, error => {\n            this.messageService.showError(error);\n          });\n        }\n      } else {\n        this.gapiservice.signIn();\n      }\n    }\n\n    awaitUploadFolder(index) {\n      this.uploadFolder(index);\n    }\n\n    creatFolder(folderId, name) {\n      this.fileService.create(folderId, name);\n    }\n\n    uploadFile(folderId, fileInfo, index) {\n      this.fileService.importFile(folderId, fileInfo, res => this.onImportComplete(res, index));\n    }\n\n    delay(ms) {\n      return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    onImportComplete(res, index) {\n      var object = JSON.parse(res);\n      this.listFile[index].Id = object.id;\n      this.listFile[index].FileType = \"1\";\n      this.awaitUploadFolder(index + 1);\n    }\n\n    closeModal() {\n      this.activeModal.close();\n    }\n\n  }\n\n  ModuleChooseFileDesignDocumentComponent.ɵfac = function ModuleChooseFileDesignDocumentComponent_Factory(t) {\n    return new (t || ModuleChooseFileDesignDocumentComponent)(i0.ɵɵdirectiveInject(i1.FileRepositoryService), i0.ɵɵdirectiveInject(i2.FileInfo), i0.ɵɵdirectiveInject(i3.ModuleTabDesignDocumentService), i0.ɵɵdirectiveInject(i4.MessageService), i0.ɵɵdirectiveInject(i5.NgbActiveModal), i0.ɵɵdirectiveInject(i6.GapiSession));\n  };\n\n  ModuleChooseFileDesignDocumentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ModuleChooseFileDesignDocumentComponent,\n    selectors: [[\"app-module-choose-file-design-document\"]],\n    decls: 33,\n    vars: 6,\n    consts: [[1, \"modal-header\"], [1, \"modal-title\", \"text-uppercase\", \"text-danger\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"close\", 3, \"click\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\", \"padding-15\"], [\"name\", \"form\", \"novalidate\", \"\", 1, \"tab-form-demo\"], [\"f\", \"ngForm\"], [1, \"form-label\"], [1, \"col-lg-12\", \"col-md-12\", \"col-sm-12\", \"col-xs-12\", \"radio\"], [1, \"radio\"], [\"type\", \"radio\", \"name\", \"FileType\", 3, \"value\", \"ngModel\", \"ngModelChange\"], [1, \"checkround\"], [\"id\", \"dropzone\", 3, \"dragover\", \"drop\"], [\"id\", \"boxtitle\"], [1, \"modal-footer\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 3, \"click\"], [1, \"fa\", \"fa-power-off\"]],\n    template: function ModuleChooseFileDesignDocumentComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h4\", 1);\n        i0.ɵɵtext(2, \"Upload t\\u00E0i li\\u1EC7u thi\\u1EBFt k\\u1EBF\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"button\", 2);\n        i0.ɵɵlistener(\"click\", function ModuleChooseFileDesignDocumentComponent_Template_button_click_3_listener() {\n          return ctx.closeModal();\n        });\n        i0.ɵɵelementStart(4, \"span\", 3);\n        i0.ɵɵtext(5, \"\\u00D7\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(6, \"div\", 4)(7, \"form\", 5, 6)(9, \"label\", 7);\n        i0.ɵɵtext(10, \"Lo\\u1EA1i thi\\u1EBFt k\\u1EBF\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"div\", 8)(12, \"label\", 9);\n        i0.ɵɵtext(13, \"Thi\\u1EBFt k\\u1EBF c\\u01A1 kh\\u00ED \");\n        i0.ɵɵelementStart(14, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function ModuleChooseFileDesignDocumentComponent_Template_input_ngModelChange_14_listener($event) {\n          return ctx.importModel.DesignType = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(15, \"span\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"label\", 9);\n        i0.ɵɵtext(17, \"Thi\\u1EBFt k\\u1EBF \\u0111i\\u1EC7n \");\n        i0.ɵɵelementStart(18, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function ModuleChooseFileDesignDocumentComponent_Template_input_ngModelChange_18_listener($event) {\n          return ctx.importModel.DesignType = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(19, \"span\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"label\", 9);\n        i0.ɵɵtext(21, \"Thi\\u1EBFt k\\u1EBF \\u0111i\\u1EC7n t\\u1EED \");\n        i0.ɵɵelementStart(22, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function ModuleChooseFileDesignDocumentComponent_Template_input_ngModelChange_22_listener($event) {\n          return ctx.importModel.DesignType = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(23, \"span\", 11);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(24, \"div\", 12);\n        i0.ɵɵlistener(\"dragover\", function ModuleChooseFileDesignDocumentComponent_Template_div_dragover_24_listener($event) {\n          return ctx.dragover($event);\n        })(\"drop\", function ModuleChooseFileDesignDocumentComponent_Template_div_drop_24_listener($event) {\n          return ctx.drop($event);\n        });\n        i0.ɵɵelementStart(25, \"div\", 13);\n        i0.ɵɵtext(26, \" Drop Files Here \");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(27, \"div\", 14)(28, \"button\", 15);\n        i0.ɵɵlistener(\"click\", function ModuleChooseFileDesignDocumentComponent_Template_button_click_28_listener() {\n          return ctx.closeModal();\n        });\n        i0.ɵɵelement(29, \"i\", 16);\n        i0.ɵɵtext(30, \" \\u00A0 \");\n        i0.ɵɵelementStart(31, \"span\");\n        i0.ɵɵtext(32, \" \\u0110\\u00F3ng \");\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(14);\n        i0.ɵɵproperty(\"value\", 1)(\"ngModel\", ctx.importModel.DesignType);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"value\", 2)(\"ngModel\", ctx.importModel.DesignType);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"value\", 3)(\"ngModel\", ctx.importModel.DesignType);\n      }\n    },\n    styles: [\"app-module-choose-file-design-document #dropzone{text-align:center;width:300px;height:100px;margin:10px;padding:10px;border:4px dashed red;border-radius:10px}app-module-choose-file-design-document #boxtitle{display:table-cell;vertical-align:middle;text-align:center;color:#000;font:700 2em Arial,sans-serif;width:300px;height:100px}app-module-choose-file-design-document body{font:14px Arial,sans-serif}\\n\"],\n    encapsulation: 2\n  });\n  return ModuleChooseFileDesignDocumentComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}