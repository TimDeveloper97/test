{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"../../services/product-standard-tpa.service\";\nimport * as i3 from \"src/app/upload/uploadfile.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"ngx-perfect-scrollbar\";\n\nfunction ProductStandardTpaFileViewComponent_tr_17_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(row_r2.name);\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_17_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(row_r2.FileName);\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_17_span_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(2, 1, row_r2.size / (1024 * 1024), \"1.1-3\"), \" MB\");\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_17_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(2, 1, row_r2.FileSize / (1024 * 1024), \"1.1-3\"), \" MB\");\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 11);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtemplate(4, ProductStandardTpaFileViewComponent_tr_17_span_4_Template, 2, 1, \"span\", 12);\n    i0.ɵɵtemplate(5, ProductStandardTpaFileViewComponent_tr_17_span_5_Template, 2, 1, \"span\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\", 11);\n    i0.ɵɵtemplate(7, ProductStandardTpaFileViewComponent_tr_17_span_7_Template, 3, 4, \"span\", 12);\n    i0.ɵɵtemplate(8, ProductStandardTpaFileViewComponent_tr_17_span_8_Template, 3, 4, \"span\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\")(10, \"div\", 13)(11, \"input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductStandardTpaFileViewComponent_tr_17_Template_input_ngModelChange_11_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const row_r2 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(row_r2.Note = $event);\n    });\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const row_r2 = ctx.$implicit;\n    const i_r3 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r3 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", row_r2.Id == null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", row_r2.Id != null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", row_r2.Id == null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", row_r2.Id != null);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", row_r2.Note)(\"name\", \"rowNote\" + i_r3);\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_35_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(row_r14.name);\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_35_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(row_r14.FileName);\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_35_span_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(2, 1, row_r14.size / (1024 * 1024), \"1.1-3\"), \" MB\");\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_35_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(2, 1, row_r14.FileSize / (1024 * 1024), \"1.1-3\"), \" MB\");\n  }\n}\n\nfunction ProductStandardTpaFileViewComponent_tr_35_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r25 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 11);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtemplate(4, ProductStandardTpaFileViewComponent_tr_35_span_4_Template, 2, 1, \"span\", 12);\n    i0.ɵɵtemplate(5, ProductStandardTpaFileViewComponent_tr_35_span_5_Template, 2, 1, \"span\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\", 11);\n    i0.ɵɵtemplate(7, ProductStandardTpaFileViewComponent_tr_35_span_7_Template, 3, 4, \"span\", 12);\n    i0.ɵɵtemplate(8, ProductStandardTpaFileViewComponent_tr_35_span_8_Template, 3, 4, \"span\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\")(10, \"div\", 13)(11, \"input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductStandardTpaFileViewComponent_tr_35_Template_input_ngModelChange_11_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r25);\n      const row_r14 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(row_r14.Note = $event);\n    });\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const row_r14 = ctx.$implicit;\n    const i_r15 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r15 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", row_r14.Id == null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", row_r14.Id != null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", row_r14.Id == null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", row_r14.Id != null);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", row_r14.Note)(\"name\", \"rowNote\" + i_r15);\n  }\n}\n\nexport let ProductStandardTpaFileViewComponent = /*#__PURE__*/(() => {\n  class ProductStandardTpaFileViewComponent {\n    constructor(constants, service, messageService, fileProcess, uploadService) {\n      this.constants = constants;\n      this.service = service;\n      this.messageService = messageService;\n      this.fileProcess = fileProcess;\n      this.uploadService = uploadService;\n      this.listFileAttach = [];\n      this.listCatalog = [];\n      this.model = {\n        ProductStandardTPAId: '',\n        ListFile: []\n      };\n      this.fileModel = {\n        Id: '',\n        FileName: '',\n        FileSize: '',\n        FilePath: '',\n        Note: '',\n        Type: 0\n      };\n    }\n\n    ngOnInit() {\n      this.model.ProductStandardTPAId = this.Id;\n      this.getListProductStandardTPAFile();\n    }\n\n    uploadFileAttach($event) {\n      var fileDataSheet = this.fileProcess.getFileOnFileChange($event);\n      var isExist = false;\n\n      for (var file of fileDataSheet) {\n        isExist = false;\n\n        for (var ite of this.listFileAttach) {\n          if (ite.Id != null) {\n            if (file.name == ite.FileName) {\n              isExist = true;\n            }\n          } else {\n            if (file.name == ite.name) {\n              isExist = true;\n            }\n          }\n        }\n      }\n\n      if (isExist) {\n        this.messageService.showConfirm(\"File đã tồn tại. Bạn có muốn ghi đè lên không\").then(data => {\n          this.updateFileAndReplaceManualDocument(fileDataSheet, true, this.listFileAttach, 2);\n        }, error => {\n          this.updateFileAndReplaceManualDocument(fileDataSheet, false, this.listFileAttach, 2);\n        });\n      } else {\n        this.updateFileManualDocument(fileDataSheet, this.listFileAttach, 2);\n      }\n    }\n\n    uploadFileCatalog($event) {\n      var fileDataSheet = this.fileProcess.getFileOnFileChange($event);\n      var isExist = false;\n\n      for (var file of fileDataSheet) {\n        isExist = false;\n\n        for (var ite of this.listCatalog) {\n          if (ite.Id != null) {\n            if (file.name == ite.FileName) {\n              isExist = true;\n            }\n          } else {\n            if (file.name == ite.name) {\n              isExist = true;\n            }\n          }\n        }\n      }\n\n      if (isExist) {\n        this.messageService.showConfirm(\"File đã tồn tại. Bạn có muốn ghi đè lên không\").then(data => {\n          this.updateFileAndReplaceManualDocument(fileDataSheet, true, this.listCatalog, 1);\n        }, error => {\n          this.updateFileAndReplaceManualDocument(fileDataSheet, false, this.listCatalog, 1);\n        });\n      } else {\n        this.updateFileManualDocument(fileDataSheet, this.listCatalog, 1);\n      }\n    }\n\n    updateFileAndReplaceManualDocument(fileManualDocuments, isReplace, listFile, type) {\n      var isExist = false;\n\n      for (var file of fileManualDocuments) {\n        for (let index = 0; index < listFile.length; index++) {\n          if (listFile[index].Id != null) {\n            if (file.name == listFile[index].FileName) {\n              isExist = true;\n\n              if (isReplace) {\n                listFile.splice(index, 1);\n              }\n            }\n          } else if (file.name == listFile[index].name) {\n            isExist = true;\n\n            if (isReplace) {\n              listFile.splice(index, 1);\n            }\n          }\n        }\n\n        if (!isExist || isReplace) {\n          file.IsFileUpload = true;\n          file.Type = type;\n          listFile.push(file);\n        }\n      }\n    }\n\n    updateFileManualDocument(fileManualDocuments, listFile, type) {\n      for (var file of fileManualDocuments) {\n        file.Type = type;\n        listFile.push(file);\n      }\n    }\n\n    showConfirmDeleteFile(index) {\n      this.messageService.showConfirm(\"Bạn có chắc chắn muốn xóa file hướng dẫn sử dụng này không?\").then(data => {\n        this.listFileAttach.splice(index, 1);\n      }, error => {});\n    }\n\n    showConfirmDeleteCatalog(index) {\n      this.messageService.showConfirm(\"Bạn có chắc chắn muốn xóa file Catolog này không?\").then(data => {\n        this.listCatalog.splice(index, 1);\n      }, error => {});\n    }\n\n    downloadDocument(file) {\n      this.fileProcess.downloadFileBlob(file.FilePath, file.FileName);\n    }\n\n    downloadCatalog(file) {\n      this.fileProcess.downloadFileBlob(file.FilePath, file.FileName);\n    }\n\n    getListProductStandardTPAFile() {\n      this.service.getListProductStandardTPAFile(this.model).subscribe(data => {\n        if (data) {\n          this.listFileAttach = data.listFile;\n          this.listCatalog = data.listCatolog;\n        }\n      }, error => {\n        this.messageService.showError(error);\n      });\n    }\n\n    save() {\n      this.model.ListFile = [];\n      this.listCatalog.forEach(element => {\n        element.Type = 1;\n        this.model.ListFile.push(element);\n      });\n      this.listFileAttach.forEach(element => {\n        element.Type = 2;\n        this.model.ListFile.push(element);\n      });\n      this.uploadService.uploadListFile(this.model.ListFile, 'ProductStandardTPAFile/').subscribe(event => {\n        if (event.length > 0) {\n          // event.forEach((item, index) => {\n          //   var file = Object.assign({}, this.fileModel);\n          //   file.FileName = item.FileName;\n          //   file.FileSize = item.FileSize;\n          //   file.FilePath = item.FileUrl;\n          //   file.Type = item.Type;\n          //   file.Note = item.Note;\n          //   this.model.ListFile.push(file);\n          // });\n          var count = 0;\n          this.model.ListFile.forEach(item => {\n            if (!item.FilePath) {\n              item.FileName = event[count].FileName;\n              item.FileSize = event[count].FileSize;\n              item.FilePath = event[count].FileUrl;\n              count++;\n            }\n          });\n        }\n\n        for (var item of this.model.ListFile) {\n          if (item.FilePath == null || item.FilePath == \"\") {\n            this.model.ListFile.splice(this.model.ListFile.indexOf(item), 1);\n          }\n        }\n\n        this.service.uploadFile(this.model).subscribe(() => {\n          this.messageService.showSuccess('Cập nhật tài liệu thành công!');\n          this.getListProductStandardTPAFile();\n        }, error => {\n          this.messageService.showError(error);\n        });\n      }, error => {\n        this.messageService.showError(error);\n      });\n    }\n\n  }\n\n  ProductStandardTpaFileViewComponent.ɵfac = function ProductStandardTpaFileViewComponent_Factory(t) {\n    return new (t || ProductStandardTpaFileViewComponent)(i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i2.ProductStandardTpaService), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i1.FileProcess), i0.ɵɵdirectiveInject(i3.UploadfileService));\n  };\n\n  ProductStandardTpaFileViewComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ProductStandardTpaFileViewComponent,\n    selectors: [[\"app-product-standard-tpa-file-view\"]],\n    inputs: {\n      Id: \"Id\"\n    },\n    decls: 36,\n    vars: 4,\n    consts: [[1, \"row\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-6\", \"text-left\"], [1, \"form-label\"], [2, \"height\", \"auto\", \"width\", \"100%\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"min-width\", \"550px\"], [\"width\", \"50px\", 1, \"text-center\"], [\"min-width\", \"200px\", 1, \"text-center\"], [\"width\", \"100px\", 1, \"text-center\"], [\"width\", \"200px\", 1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"], [1, \"row\", \"mt-3\"], [1, \"text-center\"], [4, \"ngIf\"], [1, \"controls\"], [\"type\", \"text\", \"maxlength\", \"300\", 1, \"form-control\", 3, \"ngModel\", \"name\", \"ngModelChange\"]],\n    template: function ProductStandardTpaFileViewComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"label\", 2);\n        i0.ɵɵtext(3, \"T\\u00E0i li\\u1EC7u h\\u01B0\\u1EDBng d\\u1EABn s\\u1EED d\\u1EE5ng \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(4, \"perfect-scrollbar\", 3)(5, \"table\", 4)(6, \"thead\")(7, \"tr\")(8, \"th\", 5);\n        i0.ɵɵtext(9, \"STT\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"th\", 6);\n        i0.ɵɵtext(11, \"T\\u00EAn file\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\", 7);\n        i0.ɵɵtext(13, \"Dung l\\u01B0\\u1EE3ng\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\", 8);\n        i0.ɵɵtext(15, \"M\\u00F4 t\\u1EA3\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(16, \"tbody\");\n        i0.ɵɵtemplate(17, ProductStandardTpaFileViewComponent_tr_17_Template, 12, 7, \"tr\", 9);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(18, \"div\", 10)(19, \"div\", 1)(20, \"label\", 2);\n        i0.ɵɵtext(21, \"T\\u00E0i li\\u1EC7u Catalog \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(22, \"perfect-scrollbar\", 3)(23, \"table\", 4)(24, \"thead\")(25, \"tr\")(26, \"th\", 5);\n        i0.ɵɵtext(27, \"STT\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"th\", 6);\n        i0.ɵɵtext(29, \"T\\u00EAn file\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"th\", 7);\n        i0.ɵɵtext(31, \"Dung l\\u01B0\\u1EE3ng\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"th\", 8);\n        i0.ɵɵtext(33, \"M\\u00F4 t\\u1EA3\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(34, \"tbody\");\n        i0.ɵɵtemplate(35, ProductStandardTpaFileViewComponent_tr_35_Template, 12, 7, \"tr\", 9);\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"config\", ctx.constants.ScrollXConfig);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listFileAttach);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"config\", ctx.constants.ScrollXConfig);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listCatalog);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i5.DefaultValueAccessor, i5.NgControlStatus, i5.MaxLengthValidator, i5.NgModel, i6.PerfectScrollbarComponent, i4.DecimalPipe]\n  });\n  return ProductStandardTpaFileViewComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}