{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { BroadcastEventListener } from 'src/app/signalr/broadcast.event.listener';\nimport { BlockUI } from 'ng-block-ui';\nimport { SolutionChooseFolderUploadModalComponent } from '../solution-choose-folder-upload-modal/solution-choose-folder-upload-modal.component';\nimport { SolutionChooseFileUploadModalComponent } from '../solution-choose-file-upload-modal/solution-choose-file-upload-modal.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i3 from \"src/app/signalR/signal-r.service\";\nimport * as i4 from \"../service/solution.service\";\n\nfunction SolutionTabDesignDocumentComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵelement(2, \"span\", 24);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const e_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", e_r3.icon);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\\u00A0 \", e_r3.text, \" \");\n  }\n}\n\nfunction SolutionTabDesignDocumentComponent_button_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function SolutionTabDesignDocumentComponent_button_19_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.showChooseFolderUpload());\n    });\n    i0.ɵɵelement(1, \"i\", 26);\n    i0.ɵɵtext(2, \" Upload t\\u00E0i li\\u1EC7u \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SolutionTabDesignDocumentComponent_tr_39_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function SolutionTabDesignDocumentComponent_tr_39_button_7_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const row_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.downloadFile(row_r6.Id, row_r6.Name, row_r6.ServerPath, row_r6.DesignType));\n    });\n    i0.ɵɵelement(1, \"span\", 34);\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst _c0 = function () {\n  return [\"F030413\"];\n};\n\nfunction SolutionTabDesignDocumentComponent_tr_39_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 19);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 27)(4, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function SolutionTabDesignDocumentComponent_tr_39_Template_button_click_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const row_r6 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.uploadFile(row_r6.Id));\n    });\n    i0.ɵɵelement(5, \"span\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \" \\u00A0 \");\n    i0.ɵɵtemplate(7, SolutionTabDesignDocumentComponent_tr_39_button_7_Template, 2, 0, \"button\", 30);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\", 31);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\", 32);\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 22);\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"td\", 22);\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const row_r6 = ctx.$implicit;\n    const i_r7 = ctx.index;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.startIndex + i_r7);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"appUipermission\", i0.ɵɵpureFunction0(14, _c0));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r6.Name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(12, 6, row_r6.FileSize));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 8, row_r6.CreateDate, \"dd/MM/yyyy\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(18, 11, row_r6.UpdateDate, \"dd/MM/yyyy\"));\n  }\n}\n\nconst _c1 = function () {\n  return [\"F030412\"];\n};\n\nexport class SolutionTabDesignDocumentComponent {\n  constructor(constants, modalService, signalRService, solutionService, messageService, config, componentService) {\n    this.constants = constants;\n    this.modalService = modalService;\n    this.signalRService = signalRService;\n    this.solutionService = solutionService;\n    this.messageService = messageService;\n    this.config = config;\n    this.componentService = componentService;\n    this.onDownload = new BroadcastEventListener('downloadFileSolutionDesignDocument');\n    this.onDownloadFolder = new BroadcastEventListener('downloadFolderSolutionDesignDocument');\n    this.startIndex = 1;\n    this.solutionModel = {\n      SolutionId: '',\n      FolderId: '',\n      Path: '',\n      ApiUrl: '',\n      Token: '',\n      Name: ''\n    };\n    this.ListFolder = [];\n    this.ListFile = [];\n    this.ListDesignDocumentId = [];\n    this.folderHeight = 0;\n    this.items = [{\n      Id: 1,\n      text: 'Download',\n      icon: 'fa fa-arrow-down text-success'\n    }];\n    this.searchOptions = {\n      FieldContentName: 'Name',\n      Placeholder: 'Nhập tên file',\n      Items: []\n    };\n  }\n\n  ngOnInit() {\n    this.folderHeight = window.innerHeight - 140;\n    this.solutionModel.SolutionId = this.Id;\n    this.getListFolder();\n    this.signalRService.listen(this.onDownload, true);\n    this.downloadSub = this.onDownload.subscribe(data => {\n      this.blockUI.stop();\n\n      if (data) {\n        if (data.StatusCode == 2) {\n          this.messageService.showMessage(data.Message);\n        } else {\n          this.messageService.showMessage('Download thành công!');\n        }\n      }\n    });\n    this.signalRService.listen(this.onDownloadFolder, true);\n    this.downloadFolderSub = this.onDownloadFolder.subscribe(data => {\n      this.blockUI.stop();\n\n      if (data) {\n        if (data.StatusCode == 2) {\n          this.messageService.showMessage(data.Message);\n        } else {\n          this.messageService.showMessage('Download thành công!');\n        }\n      }\n    });\n  }\n\n  getListFolder() {\n    this.solutionService.getListFolderSolution(this.Id, this.curentVersion).subscribe(data => {\n      if (data) {\n        this.ListFolder = data;\n        console.log(this.ListFolder);\n\n        for (var item of this.ListFolder) {\n          this.ListDesignDocumentId.push(item.Id);\n        }\n      }\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  showChooseFolderUpload() {\n    let activeModal = this.modalService.open(SolutionChooseFolderUploadModalComponent, {\n      container: 'body',\n      windowClass: 'solution-choose-folder-upload-modal',\n      backdrop: 'static'\n    });\n    activeModal.componentInstance.solutionId = this.Id;\n    activeModal.componentInstance.curentVersion = this.curentVersion;\n    activeModal.result.then(result => {\n      this.curentVersion = result;\n      this.getListFolder();\n    }, reason => {});\n  }\n\n  ngOnDestroy() {\n    this.downloadSub.unsubscribe();\n    this.signalRService.stopListening(this.onDownload);\n    this.downloadFolderSub.unsubscribe();\n    this.signalRService.stopListening(this.onDownloadFolder);\n  }\n\n  onSelectionChanged(e) {\n    this.solutionModel.FolderId = e.selectedRowKeys[0];\n    this.searchFile();\n    this.folderId = e.selectedRowKeys[0];\n    this.designTypes = e.selectedRowsData[0].DesignType;\n  }\n\n  searchFile() {\n    this.solutionService.getListFileSolution(this.solutionModel).subscribe(data => {\n      if (data) {\n        this.ListFile = data.ListResult;\n      }\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  downloadFile(id, name, serverPath, designType) {\n    this.componentService.showChooseFolder(3, this.designTypes, this.Id).subscribe(result => {\n      if (result) {\n        var file = {\n          Id: id,\n          Name: name,\n          ServerPath: serverPath,\n          DownloadPath: result,\n          Token: '',\n          ApiUrl: this.config.ServerApi\n        };\n        let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n        if (currentUser && currentUser.access_token) {\n          file.Token = currentUser.access_token;\n        }\n\n        this.signalRService.invoke('DownloadFileSolutionDesignDocument', file).subscribe(data => {\n          if (data) {\n            this.blockUI.start();\n          } else {\n            this.messageService.showMessage(\"Không kết nối được service\");\n          }\n        });\n      }\n    });\n  }\n\n  itemClick(e) {\n    if (!this.folderId) {\n      this.messageService.showMessage(\"Bạn chưa chọn thư mục cần download!\");\n    } else {\n      this.componentService.showChooseFolder(3, this.designTypes, this.Id).subscribe(result => {\n        if (result) {\n          var file = {\n            Id: this.folderId,\n            DownloadPath: result,\n            ObjectId: this.Id,\n            Token: '',\n            ApiUrl: this.config.ServerApi\n          };\n          let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n          if (currentUser && currentUser.access_token) {\n            file.Token = currentUser.access_token;\n          }\n\n          this.signalRService.invoke('DownloadFolderSolutionDesignDocument', file).subscribe(data => {\n            if (data) {\n              this.blockUI.start();\n            } else {\n              this.messageService.showMessage(\"Không kết nối được service\");\n            }\n          });\n        }\n      });\n    }\n  }\n\n  uploadFile(id) {\n    let activeModal = this.modalService.open(SolutionChooseFileUploadModalComponent, {\n      container: 'body',\n      windowClass: 'solution-choose-file-upload-modal',\n      backdrop: 'static'\n    });\n    activeModal.componentInstance.solutionId = id;\n    activeModal.componentInstance.curentVersion = this.curentVersion;\n    activeModal.result.then(result => {\n      this.curentVersion = result;\n      this.getListFolder();\n    }, reason => {});\n  }\n\n}\n\nSolutionTabDesignDocumentComponent.ɵfac = function SolutionTabDesignDocumentComponent_Factory(t) {\n  return new (t || SolutionTabDesignDocumentComponent)(i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i2.NgbModal), i0.ɵɵdirectiveInject(i3.SignalRService), i0.ɵɵdirectiveInject(i4.SolutionService), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i1.Configuration), i0.ɵɵdirectiveInject(i1.ComponentService));\n};\n\nSolutionTabDesignDocumentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: SolutionTabDesignDocumentComponent,\n  selectors: [[\"app-solution-tab-design-document\"]],\n  inputs: {\n    Id: \"Id\",\n    curentVersion: \"curentVersion\"\n  },\n  decls: 40,\n  vars: 15,\n  consts: [[1, \"d-flex\"], [1, \"search-left\"], [1, \"row\"], [1, \"col-md-12\", \"col-sm-12\", \"col-lg-12\"], [\"id\", \"folders\", \"keyExpr\", \"Id\", \"parentIdExpr\", \"ParentId\", 3, \"dataSource\", \"showRowLines\", \"showBorders\", \"columnAutoWidth\", \"height\", \"expandedRowKeys\", \"onSelectionChanged\"], [\"mode\", \"single\"], [\"dataField\", \"Name\", \"caption\", \"T\\u00EAn th\\u01B0 m\\u1EE5c\"], [\"keyExpr\", \"Id\", \"target\", \"#folders\", 3, \"dataSource\", \"width\", \"onItemClick\"], [4, \"dxTemplate\", \"dxTemplateOf\"], [1, \"body-right\"], [1, \"col-xl-6\", \"col-lg-6\", \"col-md-6\", \"col-sm-12\"], [\"name\", \"search\", 3, \"options\", \"ngModel\", \"optionsChange\", \"ngModelChange\", \"change\"], [1, \"row\", \"margin-bottom-10\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-12\"], [1, \"form-label\", 2, \"line-height\", \"35px\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-12\", \"text-right\"], [\"type\", \"button\", \"class\", \"btn btn-success\", \"container\", \"body\", 3, \"click\", 4, \"appUipermission\"], [2, \"height\", \"auto\", \"width\", \"100%\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"min-width\", \"690px\"], [\"width\", \"50px\", 1, \"text-center\"], [\"width\", \"100px\", 1, \"text-center\"], [\"min-width\", \"200px\", 1, \"text-center\"], [\"width\", \"120px\", 1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"], [3, \"ngClass\"], [\"type\", \"button\", \"container\", \"body\", 1, \"btn\", \"btn-success\", 3, \"click\"], [1, \"fas\", \"fa-arrow-up\"], [\"width\", \"100px\", 2, \"text-align\", \"center\"], [\"type\", \"button\", \"placement\", \"top\", \"ngbTooltip\", \"Upload file\", \"container\", \"body\", 1, \"btn\", \"btn-xs\", \"btn-success\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"fas\", \"fa-arrow-up\"], [\"type\", \"button\", \"class\", \"btn btn-xs btn-info\", \"placement\", \"top\", \"ngbTooltip\", \"Download file\", \"container\", \"body\", 3, \"click\", 4, \"appUipermission\"], [\"min-width\", \"200px\"], [\"width\", \"100px\"], [\"type\", \"button\", \"placement\", \"top\", \"ngbTooltip\", \"Download file\", \"container\", \"body\", 1, \"btn\", \"btn-xs\", \"btn-info\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"fas\", \"fa-arrow-down\"]],\n  template: function SolutionTabDesignDocumentComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"section\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"dx-tree-list\", 4);\n      i0.ɵɵlistener(\"onSelectionChanged\", function SolutionTabDesignDocumentComponent_Template_dx_tree_list_onSelectionChanged_4_listener($event) {\n        return ctx.onSelectionChanged($event);\n      });\n      i0.ɵɵelement(5, \"dxo-selection\", 5)(6, \"dxi-column\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"dx-context-menu\", 7);\n      i0.ɵɵlistener(\"onItemClick\", function SolutionTabDesignDocumentComponent_Template_dx_context_menu_onItemClick_7_listener($event) {\n        return ctx.itemClick($event);\n      });\n      i0.ɵɵtemplate(8, SolutionTabDesignDocumentComponent_div_8_Template, 4, 2, \"div\", 8);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(9, \"section\", 9)(10, \"div\", 2)(11, \"div\", 10)(12, \"nts-search-bar\", 11);\n      i0.ɵɵlistener(\"optionsChange\", function SolutionTabDesignDocumentComponent_Template_nts_search_bar_optionsChange_12_listener($event) {\n        return ctx.searchOptions = $event;\n      })(\"ngModelChange\", function SolutionTabDesignDocumentComponent_Template_nts_search_bar_ngModelChange_12_listener($event) {\n        return ctx.solutionModel = $event;\n      })(\"change\", function SolutionTabDesignDocumentComponent_Template_nts_search_bar_change_12_listener() {\n        return ctx.searchFile();\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(13, \"div\", 12)(14, \"div\", 13)(15, \"label\", 14);\n      i0.ɵɵtext(16, \"Danh s\\u00E1ch t\\u00E0i li\\u1EC7u thi\\u1EBFt k\\u1EBF\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(17, \"\\u00A0 \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"div\", 15);\n      i0.ɵɵtemplate(19, SolutionTabDesignDocumentComponent_button_19_Template, 3, 0, \"button\", 16);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(20, \"div\", 2)(21, \"div\", 3)(22, \"perfect-scrollbar\", 17)(23, \"table\", 18)(24, \"thead\")(25, \"tr\")(26, \"th\", 19);\n      i0.ɵɵtext(27, \"STT\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(28, \"th\", 20);\n      i0.ɵɵtext(29, \"X\\u1EED l\\u00FD\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(30, \"th\", 21);\n      i0.ɵɵtext(31, \"T\\u00EAn file\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(32, \"th\", 20);\n      i0.ɵɵtext(33, \"Size (byte)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(34, \"th\", 22);\n      i0.ɵɵtext(35, \"Ng\\u00E0y t\\u1EA3i l\\u00EAn\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(36, \"th\", 22);\n      i0.ɵɵtext(37, \"Ng\\u00E0y update\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(38, \"tbody\");\n      i0.ɵɵtemplate(39, SolutionTabDesignDocumentComponent_tr_39_Template, 19, 15, \"tr\", 23);\n      i0.ɵɵelementEnd()()()()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"dataSource\", ctx.ListFolder)(\"showRowLines\", true)(\"showBorders\", true)(\"columnAutoWidth\", true)(\"height\", ctx.folderHeight)(\"expandedRowKeys\", ctx.ListDesignDocumentId);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"dataSource\", ctx.items)(\"width\", 200);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dxTemplateOf\", \"item\");\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"options\", ctx.searchOptions)(\"ngModel\", ctx.solutionModel);\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"appUipermission\", i0.ɵɵpureFunction0(14, _c1));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"config\", ctx.constants.ScrollXConfig);\n      i0.ɵɵadvance(17);\n      i0.ɵɵproperty(\"ngForOf\", ctx.ListFile);\n    }\n  }\n});\n\n__decorate([BlockUI()], SolutionTabDesignDocumentComponent.prototype, \"blockUI\", void 0);","map":null,"metadata":{},"sourceType":"module"}