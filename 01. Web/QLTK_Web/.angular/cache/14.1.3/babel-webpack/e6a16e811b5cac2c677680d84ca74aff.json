{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { ChooseFolderModalComponent } from '../../choose-folder-modal/choose-folder-modal.component';\nimport { ChooseFolderUploadModalComponent } from '../../choose-folder-upload-modal/choose-folder-upload-modal.component';\nimport { ModuleChooseFolderDownloadComponent } from '../module-choose-folder-download/module-choose-folder-download.component';\nimport { BroadcastEventListener } from 'src/app/signalr/broadcast.event.listener';\nimport { BlockUI } from 'ng-block-ui';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"../../services/module-tab-design-document.service\";\nimport * as i3 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i4 from \"src/app/signalR/signal-r.service\";\n\nfunction ModuleTabDesignDocumentComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵelement(2, \"span\", 23);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const e_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", e_r3.icon);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\\u00A0 \", e_r3.text, \" \");\n  }\n}\n\nfunction ModuleTabDesignDocumentComponent_button_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ModuleTabDesignDocumentComponent_button_17_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.showChooseFolderUpload());\n    });\n    i0.ɵɵelement(1, \"i\", 25);\n    i0.ɵɵtext(2, \" Upload t\\u00E0i li\\u1EC7u \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ModuleTabDesignDocumentComponent_tr_38_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function ModuleTabDesignDocumentComponent_tr_38_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const row_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.downloadFile(row_r6.Id, row_r6.Name, row_r6.ServerPath));\n    });\n    i0.ɵɵelement(1, \"span\", 32);\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst _c0 = function () {\n  return [\"F020111\"];\n};\n\nfunction ModuleTabDesignDocumentComponent_tr_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 18);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 26);\n    i0.ɵɵtemplate(4, ModuleTabDesignDocumentComponent_tr_38_button_4_Template, 2, 0, \"button\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 28);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 29);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\", 30);\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 30);\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const row_r6 = ctx.$implicit;\n    const i_r7 = ctx.index;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.startIndex + i_r7);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"appUipermission\", i0.ɵɵpureFunction0(14, _c0));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r6.Name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 6, row_r6.FileSize));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(12, 8, row_r6.CreateDate, \"dd/MM/yyyy hh:mm:ss\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 11, row_r6.UpdateDate, \"dd/MM/yyyy hh:mm:ss\"));\n  }\n}\n\nconst _c1 = function () {\n  return [\"F020110\"];\n};\n\nexport class ModuleTabDesignDocumentComponent {\n  constructor(constants, designDocumentService, messageService, modalService, signalRService, config) {\n    this.constants = constants;\n    this.designDocumentService = designDocumentService;\n    this.messageService = messageService;\n    this.modalService = modalService;\n    this.signalRService = signalRService;\n    this.config = config;\n    this.onDownload = new BroadcastEventListener('downloadFileModuleDesignDocument');\n    this.onDownloadFolder = new BroadcastEventListener('downloadFolderModuleDesignDocument');\n    this.startIndex = 1;\n    this.moduleModel = {\n      Id: '',\n      Code: '',\n      GroupId: ''\n    };\n    this.documentModel = {\n      Id: ''\n    };\n    this.ListFolder = [];\n    this.ListFile = [];\n    this.ListDesignDocumentId = [];\n    this.listData = [];\n    this.folderHeight = 400;\n    this.items = [{\n      Id: 1,\n      text: 'Download',\n      icon: 'fa fa-arrow-down text-success'\n    }];\n  }\n\n  ngOnInit() {\n    this.folderHeight = window.innerHeight - 140;\n    this.getListFolder();\n    this.signalRService.listen(this.onDownload, true);\n    this.downloadSub = this.onDownload.subscribe(data => {\n      this.blockUI.stop();\n\n      if (data) {\n        if (data.StatusCode == 2) {\n          this.messageService.showMessage(data.Message);\n        } else {\n          this.messageService.showMessage('Download thành công!');\n        }\n      }\n    });\n    this.signalRService.listen(this.onDownloadFolder, true);\n    this.downloadFolderSub = this.onDownloadFolder.subscribe(data => {\n      this.blockUI.stop();\n\n      if (data) {\n        if (data.StatusCode == 2) {\n          this.messageService.showMessage(data.Message);\n        } else {\n          this.messageService.showMessage('Download thành công!');\n        }\n      }\n    });\n  }\n\n  getListFolder() {\n    this.moduleModel.Id = this.Id;\n    this.moduleModel.Code = this.Code;\n    this.moduleModel.GroupId = this.GroupId;\n    this.designDocumentService.getListFolderModule(this.moduleModel).subscribe(data => {\n      if (data) {\n        this.ListFolder = data;\n\n        for (var item of this.ListFolder) {\n          this.ListDesignDocumentId.push(item.Id);\n        }\n      }\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  onSelectionChanged(e) {\n    this.searchFile(e.selectedRowKeys[0]);\n    this.folderId = e.selectedRowKeys[0];\n    var data = this.ListFolder.filter(i => i.Id == this.folderId);\n\n    if (data.length > 0) {\n      this.designType = data[0].DesignType;\n    }\n  }\n\n  searchFile(folderId) {\n    this.documentModel.Id = folderId;\n    this.designDocumentService.getListFileModule(this.documentModel).subscribe(data => {\n      if (data) {\n        this.ListFile = data;\n      }\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  showConfirmdeleteModuleDesignDocument(Id) {\n    this.messageService.showConfirm(\"Bạn có chắc muốn xoá thư mục này không?\").then(data => {\n      this.deleteModuleDesignDocument(Id);\n    }, error => {});\n  }\n\n  deleteModuleDesignDocument(Id) {\n    this.designDocumentService.deleteModuleDesignDocument({\n      Id: Id\n    }).subscribe(data => {\n      this.getListFolder();\n      this.messageService.showSuccess('Xóa thư mục thành công!');\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  showChooseFolderUpload() {\n    let activeModal = this.modalService.open(ChooseFolderUploadModalComponent, {\n      container: 'body',\n      windowClass: 'choose-folder-upload-modal',\n      backdrop: 'static'\n    });\n    activeModal.componentInstance.ModuleId = this.moduleModel.Id;\n    activeModal.componentInstance.ModuleCode = this.moduleModel.Code;\n    activeModal.componentInstance.ModuleGroupId = this.moduleModel.GroupId;\n    activeModal.result.then(result => {\n      this.getListFolder();\n    }, reason => {});\n  }\n\n  showChooseFolder() {\n    let activeModal = this.modalService.open(ModuleChooseFolderDownloadComponent, {\n      container: 'body',\n      windowClass: 'module-choose-folder-download',\n      backdrop: 'static'\n    });\n    activeModal.componentInstance.ModuleId = this.moduleModel.Id;\n    activeModal.componentInstance.FolderId = this.folderId;\n  }\n\n  downloadFile(id, name, serverPath) {\n    let activeModal = this.modalService.open(ChooseFolderModalComponent, {\n      container: 'body',\n      windowClass: 'choose-folder-modal',\n      backdrop: 'static'\n    });\n    activeModal.componentInstance.designType = this.designType;\n    activeModal.componentInstance.moduleCode = this.moduleModel.Code;\n    activeModal.result.then(result => {\n      if (result) {\n        var file = {\n          Id: id,\n          Name: name,\n          ServerPath: serverPath,\n          DownloadPath: result,\n          Token: '',\n          ApiUrl: this.config.ServerApi\n        };\n        let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n        if (currentUser && currentUser.access_token) {\n          file.Token = currentUser.access_token;\n        }\n\n        this.signalRService.invoke('DownloadFileModuleDesignDocument', file).subscribe(data => {\n          if (data) {\n            this.blockUI.start();\n          } else {\n            this.messageService.showMessage(\"Không kết nối được service\");\n          }\n        });\n      }\n    }, reason => {});\n  }\n\n  itemClick(e) {\n    if (!this.folderId) {\n      this.messageService.showMessage(\"Bạn chưa chọn thư mục cần download!\");\n    } else {\n      let activeModal = this.modalService.open(ChooseFolderModalComponent, {\n        container: 'body',\n        windowClass: 'choose-folder-modal',\n        backdrop: 'static'\n      });\n      activeModal.componentInstance.designType = this.designType;\n      activeModal.componentInstance.moduleCode = this.moduleModel.Code;\n      activeModal.result.then(result => {\n        if (result) {\n          var file = {\n            Id: this.folderId,\n            DownloadPath: result,\n            ObjectId: this.Id,\n            Token: '',\n            ApiUrl: this.config.ServerApi\n          };\n          let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n          if (currentUser && currentUser.access_token) {\n            file.Token = currentUser.access_token;\n          }\n\n          this.signalRService.invoke('DownloadFolderModuleDesignDocument', file).subscribe(data => {\n            if (data) {\n              this.blockUI.start();\n            } else {\n              this.messageService.showMessage(\"Không kết nối được service\");\n            }\n          });\n        }\n      }, reason => {});\n    }\n  }\n\n  ngOnDestroy() {\n    this.downloadSub.unsubscribe();\n    this.signalRService.stopListening(this.onDownload);\n    this.downloadFolderSub.unsubscribe();\n    this.signalRService.stopListening(this.onDownloadFolder);\n  }\n\n}\n\nModuleTabDesignDocumentComponent.ɵfac = function ModuleTabDesignDocumentComponent_Factory(t) {\n  return new (t || ModuleTabDesignDocumentComponent)(i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i2.ModuleTabDesignDocumentService), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i3.NgbModal), i0.ɵɵdirectiveInject(i4.SignalRService), i0.ɵɵdirectiveInject(i1.Configuration));\n};\n\nModuleTabDesignDocumentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ModuleTabDesignDocumentComponent,\n  selectors: [[\"app-module-tab-design-document\"]],\n  inputs: {\n    Id: \"Id\",\n    Code: \"Code\",\n    GroupId: \"GroupId\"\n  },\n  decls: 39,\n  vars: 13,\n  consts: [[1, \"d-flex\"], [1, \"search-left\"], [1, \"row\"], [1, \"col-md-12\", \"col-sm-12\", \"col-lg-12\"], [\"id\", \"files\", \"keyExpr\", \"Id\", \"parentIdExpr\", \"ParentId\", 3, \"dataSource\", \"showRowLines\", \"showBorders\", \"columnAutoWidth\", \"expandedRowKeys\", \"height\", \"onSelectionChanged\"], [\"mode\", \"single\"], [\"dataField\", \"Name\", \"caption\", \"Th\\u01B0 m\\u1EE5c\"], [\"dataField\", \"TotalFile\", \"caption\", \"S\\u1ED1 l\\u01B0\\u1EE3ng file\", \"alignment\", \"left\"], [\"keyExpr\", \"Id\", \"target\", \"#files\", 3, \"dataSource\", \"width\", \"onItemClick\"], [4, \"dxTemplate\", \"dxTemplateOf\"], [1, \"body-right\"], [1, \"row\", \"margin-bottom-10\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-12\"], [1, \"form-label\", 2, \"line-height\", \"35px\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-12\", \"text-right\"], [\"type\", \"button\", \"class\", \"btn btn-success\", \"container\", \"body\", 3, \"click\", 4, \"appUipermission\"], [2, \"height\", \"auto\", \"width\", \"100%\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"min-width\", \"690px\"], [\"width\", \"50px\", 1, \"text-center\"], [\"width\", \"100px\", 1, \"text-center\"], [\"min-width\", \"200px\", 1, \"text-center\"], [\"width\", \"120px\", 1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"], [3, \"ngClass\"], [\"type\", \"button\", \"container\", \"body\", 1, \"btn\", \"btn-success\", 3, \"click\"], [1, \"fas\", \"fa-arrow-up\"], [\"width\", \"100px\", 2, \"text-align\", \"center\"], [\"type\", \"button\", \"class\", \"btn btn-xs btn-info\", \"placement\", \"bottom\", \"ngbTooltip\", \"Download file\", \"container\", \"body\", 3, \"click\", 4, \"appUipermission\"], [\"min-width\", \"200px\"], [\"width\", \"100px\"], [\"width\", \"140px\", 1, \"text-center\"], [\"type\", \"button\", \"placement\", \"bottom\", \"ngbTooltip\", \"Download file\", \"container\", \"body\", 1, \"btn\", \"btn-xs\", \"btn-info\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"fas\", \"fa-arrow-down\"]],\n  template: function ModuleTabDesignDocumentComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"section\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"dx-tree-list\", 4);\n      i0.ɵɵlistener(\"onSelectionChanged\", function ModuleTabDesignDocumentComponent_Template_dx_tree_list_onSelectionChanged_4_listener($event) {\n        return ctx.onSelectionChanged($event);\n      });\n      i0.ɵɵelement(5, \"dxo-selection\", 5)(6, \"dxi-column\", 6)(7, \"dxi-column\", 7);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"dx-context-menu\", 8);\n      i0.ɵɵlistener(\"onItemClick\", function ModuleTabDesignDocumentComponent_Template_dx_context_menu_onItemClick_8_listener($event) {\n        return ctx.itemClick($event);\n      });\n      i0.ɵɵtemplate(9, ModuleTabDesignDocumentComponent_div_9_Template, 4, 2, \"div\", 9);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(10, \"section\", 10)(11, \"div\", 11)(12, \"div\", 12)(13, \"label\", 13);\n      i0.ɵɵtext(14, \"Danh s\\u00E1ch t\\u00E0i li\\u1EC7u thi\\u1EBFt k\\u1EBF\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(15, \"\\u00A0 \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"div\", 14);\n      i0.ɵɵtemplate(17, ModuleTabDesignDocumentComponent_button_17_Template, 3, 0, \"button\", 15);\n      i0.ɵɵtext(18, \" \\u00A0 \");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(19, \"div\", 2)(20, \"div\", 3)(21, \"perfect-scrollbar\", 16)(22, \"table\", 17)(23, \"thead\")(24, \"tr\")(25, \"th\", 18);\n      i0.ɵɵtext(26, \"STT\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(27, \"th\", 19);\n      i0.ɵɵtext(28, \"X\\u1EED l\\u00FD\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(29, \"th\", 20);\n      i0.ɵɵtext(30, \"T\\u00EAn file\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(31, \"th\", 19);\n      i0.ɵɵtext(32, \"Size (byte)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(33, \"th\", 21);\n      i0.ɵɵtext(34, \"Ng\\u00E0y t\\u1EA3i l\\u00EAn\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(35, \"th\", 21);\n      i0.ɵɵtext(36, \"Ng\\u00E0y update\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(37, \"tbody\");\n      i0.ɵɵtemplate(38, ModuleTabDesignDocumentComponent_tr_38_Template, 16, 15, \"tr\", 22);\n      i0.ɵɵelementEnd()()()()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"dataSource\", ctx.ListFolder)(\"showRowLines\", true)(\"showBorders\", true)(\"columnAutoWidth\", true)(\"expandedRowKeys\", ctx.ListDesignDocumentId)(\"height\", ctx.folderHeight);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"dataSource\", ctx.items)(\"width\", 200);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dxTemplateOf\", \"item\");\n      i0.ɵɵadvance(8);\n      i0.ɵɵproperty(\"appUipermission\", i0.ɵɵpureFunction0(12, _c1));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"config\", ctx.constants.ScrollXConfig);\n      i0.ɵɵadvance(17);\n      i0.ɵɵproperty(\"ngForOf\", ctx.ListFile);\n    }\n  },\n  styles: [\"app-module-tab-design-document .search-left{width:20em;float:left;margin-left:0!important;max-width:237px}app-module-tab-design-document .body-right{width:100%;margin-left:15px!important;overflow-x:hidden;background-color:#fff}app-module-tab-design-document .selected{background-color:#0ff}app-module-tab-design-document .page-content{display:flex}\\n\"],\n  encapsulation: 2\n});\n\n__decorate([BlockUI()], ModuleTabDesignDocumentComponent.prototype, \"blockUI\", void 0);","map":null,"metadata":{},"sourceType":"module"}