{"ast":null,"code":"import { NgbActiveModal } from '@ng-bootstrap/ng-bootstrap';\nimport { MessageService, DateUtils, ComboboxService, FileProcess } from 'src/app/shared';\nimport { forkJoin } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"src/app/shared\";\nimport * as i3 from \"../../services/supplier-service\";\nimport * as i4 from \"src/app/upload/uploadfile.service\";\n\nfunction SupplierContractCreateComponent_option_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 39);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", item_r5.Id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r5.Name, \" \");\n  }\n}\n\nexport let SupplierContractCreateComponent = /*#__PURE__*/(() => {\n  class SupplierContractCreateComponent {\n    constructor(activeModal, combobox, fileProcess, messageService, supplierService, fileService, dateUtils) {\n      this.activeModal = activeModal;\n      this.combobox = combobox;\n      this.fileProcess = fileProcess;\n      this.messageService = messageService;\n      this.supplierService = supplierService;\n      this.fileService = fileService;\n      this.dateUtils = dateUtils;\n      this.modalInfo = {\n        Title: 'Thêm mới hợp đồng',\n        SaveText: 'Lưu'\n      };\n      this.supplierId = '';\n      this.model = {\n        Name: '',\n        Code: '',\n        LaborContractId: '',\n        LaborContractName: '',\n        SupplierId: '',\n        Path: '',\n        FileName: '',\n        FileSize: '',\n        SignDate: null,\n        DueDate: null,\n        CreateByName: '',\n        CreateDate: ''\n      };\n      this.signDate = null;\n      this.dueDate = null;\n      this.fileModel = {\n        FileName: '',\n        Path: '',\n        FileSize: null,\n        CreateBy: null,\n        CreateDate: null\n      };\n      this.laborContracts = [];\n      this.fileToUpload = null;\n    }\n\n    ngOnInit() {\n      let userLocal = localStorage.getItem('qltkcurrentUser');\n\n      if (userLocal) {\n        this.user = JSON.parse(userLocal);\n      }\n\n      this.getCbbData();\n\n      if (this.SupplierContractId) {\n        this.modalInfo.Title = 'Chỉnh sửa hợp đồng';\n        this.modalInfo.SaveText = 'Lưu';\n        this.getSupplierContractInfo();\n      } else {\n        this.modalInfo.Title = \"Thêm mới hợp đồng\"; // this.getSupplierCode();\n      }\n    }\n\n    getSupplierContractInfo() {\n      this.supplierService.getSupplierContractInfo({\n        Id: this.SupplierContractId\n      }).subscribe(data => {\n        this.model = data;\n\n        if (data.SignDate != null && data.SignDate != '') {\n          this.model.SignDate = this.dateUtils.convertDateToObject(data.SignDate);\n        }\n\n        if (data.DueDate != null && data.DueDate != '') {\n          this.model.DueDate = this.dateUtils.convertDateToObject(data.DueDate);\n        }\n\n        this.modalInfo.Title = \"Chỉnh sửa hợp đồng - \" + this.model.Name;\n      }, error => {\n        this.messageService.showError(error);\n      });\n    }\n\n    getCbbData() {\n      let cbbLaborContract = this.combobox.getLabroContractSupplier();\n      forkJoin([cbbLaborContract]).subscribe(results => {\n        this.laborContracts = results[0];\n      });\n    }\n\n    uploadFileClick($event) {\n      this.fileProcess.onAFileChange($event);\n      this.fileService.uploadFile(this.fileProcess.FileDataBase, 'SupplierContracts/').subscribe(data => {\n        if (data != null) {\n          this.model.Path = data.FileUrl;\n          this.model.FileName = data.FileName;\n          this.model.FileSize = data.FileSize;\n        }\n      });\n    }\n\n    showConfirmDeleteFile() {\n      this.messageService.showConfirm(\"Bạn có chắc muốn xoá file này không?\").then(data => {\n        this.model.splice(1, 1);\n        this.messageService.showSuccess('Xóa file thành công!');\n      }, error => {});\n    }\n\n    save() {\n      if (this.model.SignDate != null && this.model.SignDate != '') {\n        this.model.SignDate = this.dateUtils.convertObjectToDate(this.model.SignDate);\n      }\n\n      if (this.model.DueDate != null && this.model.DueDate != '') {\n        this.model.DueDate = this.dateUtils.convertObjectToDate(this.model.DueDate);\n      }\n\n      this.model.SupplierId = this.supplierId;\n\n      if (this.model.Id) {\n        this.model.UpdateBy = JSON.parse(localStorage.getItem('qltkcurrentUser')).userid;\n        this.supplierService.updateSupplierContract(this.model).subscribe(() => {\n          this.activeModal.close();\n          this.getSupplierContractInfo();\n          this.messageService.showSuccess('Cập nhật nhà cung cấp thành công!');\n        }, error => {\n          this.messageService.showError(error);\n        });\n      } else {\n        this.supplierService.CreateSupplierContract(this.model).subscribe(data => {\n          this.clear();\n          this.messageService.showSuccess('Thêm mới nhân viên thành công!');\n          this.activeModal.close(true);\n        }, error => {\n          this.messageService.showError(error);\n        });\n      }\n    }\n\n    clear() {\n      this.model = {\n        Name: '',\n        Code: '',\n        LaborContractId: '',\n        LaborContractName: '',\n        SupplierId: '',\n        Path: '',\n        FileName: '',\n        FileSize: '',\n        SignDate: null,\n        DueDate: null,\n        CreateByName: '',\n        CreateDate: ''\n      };\n      this.fileModel = {\n        FileName: '',\n        Path: '',\n        FileSize: null,\n        CreateBy: null,\n        CreateDate: null\n      };\n    }\n\n    closeModal() {\n      this.activeModal.close();\n    }\n\n  }\n\n  SupplierContractCreateComponent.ɵfac = function SupplierContractCreateComponent_Factory(t) {\n    return new (t || SupplierContractCreateComponent)(i0.ɵɵdirectiveInject(i1.NgbActiveModal), i0.ɵɵdirectiveInject(i2.ComboboxService), i0.ɵɵdirectiveInject(i2.FileProcess), i0.ɵɵdirectiveInject(i2.MessageService), i0.ɵɵdirectiveInject(i3.SupplierService), i0.ɵɵdirectiveInject(i4.UploadfileService), i0.ɵɵdirectiveInject(i2.DateUtils));\n  };\n\n  SupplierContractCreateComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SupplierContractCreateComponent,\n    selectors: [[\"app-supplier-contract-create\"]],\n    decls: 83,\n    vars: 11,\n    consts: [[1, \"modal-header\"], [1, \"modal-title\", \"text-uppercase\", \"text-danger\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"close\", 3, \"click\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\", \"padding-15\"], [\"name\", \"form\", \"novalidate\", \"\", 1, \"tab-form-demo\"], [\"f\", \"ngForm\"], [1, \"row\"], [1, \"col-lg-12\", \"col-md-12\", \"col-sm-12\", \"col-xs-12\"], [1, \"form-group\"], [1, \"col-md-6\", \"col-lg-6\", \"col-sm-12\", \"col-xl-6\"], [1, \"form-label\"], [1, \"controls\"], [\"type\", \"text\", \"name\", \"Name\", \"maxlength\", \"500\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"Code\", \"maxlength\", \"50\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"text-danger\", \"text-strong\"], [1, \"input-group\"], [\"data-size\", \"3\", \"required\", \"\", \"name\", \"LaborContractId\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"style\", \"height: auto;\", 3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-md-10\", \"col-lg-10\", \"col-sm-12\", \"col-xl-10\"], [\"required\", \"\", \"type\", \"text\", \"name\", \"FileName\", 1, \"form-control\", 3, \"ngModel\", \"value\", \"ngModelChange\"], [1, \"col-md-2\", \"col-lg-2\", \"col-sm-12\", \"col-xl-2\"], [1, \"btn\", \"btn-success\", 3, \"click\"], [1, \"fas\", \"fa-plus\"], [\"name\", \"file\", \"type\", \"file\", \"id\", \"fileInput\", \"multiple\", \"\", 2, \"display\", \"none\", 3, \"change\", \"click\"], [\"fileInput\", \"\"], [\"placeholder\", \"dd/mm/yyyy\", \"name\", \"SignDate\", \"ngbDatepicker\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"SignDate\", \"ngbDatepicker\"], [1, \"input-group-append\"], [\"name\", \"SignDate\", 1, \"dtp-icon\", 3, \"click\"], [1, \"far\", \"fa-calendar-alt\", 2, \"color\", \"#999\"], [\"placeholder\", \"dd/mm/yyyy\", \"name\", \"DueDate\", \"ngbDatepicker\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"DueDate\", \"ngbDatepicker\"], [\"name\", \"DueDate\", 1, \"dtp-icon\", 3, \"click\"], [1, \"modal-footer\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", 3, \"disabled\", \"click\"], [1, \"fa\", \"fa-save\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 3, \"click\"], [1, \"fa\", \"fa-power-off\"], [2, \"height\", \"auto\", 3, \"ngValue\"]],\n    template: function SupplierContractCreateComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r6 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h4\", 1);\n        i0.ɵɵtext(2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"button\", 2);\n        i0.ɵɵlistener(\"click\", function SupplierContractCreateComponent_Template_button_click_3_listener() {\n          return ctx.closeModal();\n        });\n        i0.ɵɵelementStart(4, \"span\", 3);\n        i0.ɵɵtext(5, \"\\u00D7\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(6, \"div\", 4)(7, \"form\", 5, 6)(9, \"div\", 7)(10, \"div\", 8)(11, \"div\", 9)(12, \"div\", 7)(13, \"div\", 10)(14, \"label\", 11);\n        i0.ɵɵtext(15, \"T\\u00EAn h\\u1EE3p \\u0111\\u1ED3ng \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"div\", 12)(17, \"input\", 13);\n        i0.ɵɵlistener(\"ngModelChange\", function SupplierContractCreateComponent_Template_input_ngModelChange_17_listener($event) {\n          return ctx.model.Name = $event;\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(18, \"div\", 10)(19, \"label\", 11);\n        i0.ɵɵtext(20, \"S\\u1ED1 h\\u1EE3p \\u0111\\u1ED3ng \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"div\", 12)(22, \"input\", 14);\n        i0.ɵɵlistener(\"ngModelChange\", function SupplierContractCreateComponent_Template_input_ngModelChange_22_listener($event) {\n          return ctx.model.Code = $event;\n        });\n        i0.ɵɵelementEnd()()()()()()();\n        i0.ɵɵelementStart(23, \"div\", 7)(24, \"div\", 8)(25, \"div\", 9)(26, \"div\", 7)(27, \"div\", 10)(28, \"label\", 11);\n        i0.ɵɵtext(29, \"Lo\\u1EA1i h\\u1EE3p \\u0111\\u1ED3ng \");\n        i0.ɵɵelementStart(30, \"span\", 15);\n        i0.ɵɵtext(31, \"\\u00A0*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(32, \"div\", 12)(33, \"div\", 16)(34, \"select\", 17);\n        i0.ɵɵlistener(\"ngModelChange\", function SupplierContractCreateComponent_Template_select_ngModelChange_34_listener($event) {\n          return ctx.model.LaborContractId = $event;\n        });\n        i0.ɵɵtemplate(35, SupplierContractCreateComponent_option_35_Template, 2, 2, \"option\", 18);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(36, \"div\", 10)(37, \"label\", 11);\n        i0.ɵɵtext(38, \"File \\u0111\\u00EDnh k\\u00E8m \");\n        i0.ɵɵelementStart(39, \"span\", 15);\n        i0.ɵɵtext(40, \"\\u00A0*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(41, \"div\", 7)(42, \"div\", 19)(43, \"input\", 20);\n        i0.ɵɵlistener(\"ngModelChange\", function SupplierContractCreateComponent_Template_input_ngModelChange_43_listener($event) {\n          return ctx.model.FileName = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(44, \"div\", 21)(45, \"button\", 22);\n        i0.ɵɵlistener(\"click\", function SupplierContractCreateComponent_Template_button_click_45_listener() {\n          i0.ɵɵrestoreView(_r6);\n\n          const _r2 = i0.ɵɵreference(48);\n\n          return i0.ɵɵresetView(_r2.click());\n        });\n        i0.ɵɵelement(46, \"i\", 23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(47, \"input\", 24, 25);\n        i0.ɵɵlistener(\"change\", function SupplierContractCreateComponent_Template_input_change_47_listener($event) {\n          return ctx.uploadFileClick($event);\n        })(\"click\", function SupplierContractCreateComponent_Template_input_click_47_listener() {\n          i0.ɵɵrestoreView(_r6);\n\n          const _r2 = i0.ɵɵreference(48);\n\n          return i0.ɵɵresetView(_r2.value = null);\n        });\n        i0.ɵɵelementEnd()()()()()()()();\n        i0.ɵɵelementStart(49, \"div\", 7)(50, \"div\", 8)(51, \"div\", 9)(52, \"div\", 7)(53, \"div\", 10)(54, \"label\", 11);\n        i0.ɵɵtext(55, \"Ng\\u00E0y k\\u00FD \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(56, \"div\", 16)(57, \"input\", 26, 27);\n        i0.ɵɵlistener(\"ngModelChange\", function SupplierContractCreateComponent_Template_input_ngModelChange_57_listener($event) {\n          return ctx.model.SignDate = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(59, \"div\", 28)(60, \"span\", 29);\n        i0.ɵɵlistener(\"click\", function SupplierContractCreateComponent_Template_span_click_60_listener() {\n          i0.ɵɵrestoreView(_r6);\n\n          const _r3 = i0.ɵɵreference(58);\n\n          return i0.ɵɵresetView(_r3.toggle());\n        });\n        i0.ɵɵelement(61, \"i\", 30);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(62, \"div\", 10)(63, \"label\", 11);\n        i0.ɵɵtext(64, \"Ng\\u00E0y h\\u1EBFt h\\u1EA1n \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(65, \"div\", 16)(66, \"input\", 31, 32);\n        i0.ɵɵlistener(\"ngModelChange\", function SupplierContractCreateComponent_Template_input_ngModelChange_66_listener($event) {\n          return ctx.model.DueDate = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(68, \"div\", 28)(69, \"span\", 33);\n        i0.ɵɵlistener(\"click\", function SupplierContractCreateComponent_Template_span_click_69_listener() {\n          i0.ɵɵrestoreView(_r6);\n\n          const _r4 = i0.ɵɵreference(67);\n\n          return i0.ɵɵresetView(_r4.toggle());\n        });\n        i0.ɵɵelement(70, \"i\", 30);\n        i0.ɵɵelementEnd()()()()()()()()()();\n        i0.ɵɵelementStart(71, \"div\", 34);\n        i0.ɵɵelementContainerStart(72);\n        i0.ɵɵelementStart(73, \"button\", 35);\n        i0.ɵɵlistener(\"click\", function SupplierContractCreateComponent_Template_button_click_73_listener() {\n          return ctx.save();\n        });\n        i0.ɵɵelement(74, \"i\", 36);\n        i0.ɵɵtext(75, \"\\u00A0 \");\n        i0.ɵɵelementStart(76, \"span\");\n        i0.ɵɵtext(77);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementStart(78, \"button\", 37);\n        i0.ɵɵlistener(\"click\", function SupplierContractCreateComponent_Template_button_click_78_listener() {\n          return ctx.closeModal();\n        });\n        i0.ɵɵelement(79, \"i\", 38);\n        i0.ɵɵtext(80, \" \\u00A0 \");\n        i0.ɵɵelementStart(81, \"span\");\n        i0.ɵɵtext(82, \" \\u0110\\u00F3ng \");\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(8);\n\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.modalInfo.Title);\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngModel\", ctx.model.Name);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngModel\", ctx.model.Code);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngModel\", ctx.model.LaborContractId);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.laborContracts);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngModel\", ctx.model.FileName)(\"value\", ctx.model.FileName);\n        i0.ɵɵadvance(14);\n        i0.ɵɵproperty(\"ngModel\", ctx.model.SignDate);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngModel\", ctx.model.DueDate);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"disabled\", !_r0.form.valid);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.modalInfo.SaveText);\n      }\n    },\n    styles: [\".supplier-contract-create-model .modal-dialog{max-width:1000px!important;width:1000px!important}.supplier-contract-create-model .dx-popup-content{padding:0!important}.supplier-contract-create-model .dx-treelist-search-panel.dx-textbox.dx-texteditor.dx-editor-outlined.dx-searchbox.dx-show-clear-button.dx-widget,.supplier-contract-create-model .dx-treelist-search-panel.dx-textbox.dx-texteditor.dx-editor-outlined.dx-searchbox.dx-show-clear-button.dx-texteditor-empty.dx-widget{width:100%!important;margin:0;padding:0}.supplier-contract-create-model .dx-toolbar .dx-toolbar-after{padding-left:0!important;width:100%}\\n\"],\n    encapsulation: 2\n  });\n  return SupplierContractCreateComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}