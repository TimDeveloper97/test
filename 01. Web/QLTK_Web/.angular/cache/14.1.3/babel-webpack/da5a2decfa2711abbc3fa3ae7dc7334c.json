{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"src/app/shared/common/check-special-characters\";\nimport * as i4 from \"@angular/platform-browser\";\nimport * as i5 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i6 from \"../../service/project-product.service\";\nimport * as i7 from \"../../service/project-payment.service\";\n\nfunction ProjectProductStatusPerformComponent_th_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"width\", 150);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r2.StageName);\n  }\n}\n\nfunction ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 10)(2, \"div\", 11);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const item_r7 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", item_r7.DoneRatio + \"%\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", item_r7.DoneRatio, \"%\");\n  }\n}\n\nfunction ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" Open \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" Ho\\u00E0n th\\u00E0nh \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" Kh\\u00F4ng tri\\u1EC3n khai \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction ProjectProductStatusPerformComponent_tr_9_td_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 8);\n    i0.ɵɵtemplate(1, ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_1_Template, 4, 3, \"ng-container\", 9);\n    i0.ɵɵtemplate(2, ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_2_Template, 2, 0, \"ng-container\", 9);\n    i0.ɵɵtemplate(3, ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_3_Template, 2, 0, \"ng-container\", 9);\n    i0.ɵɵtemplate(4, ProjectProductStatusPerformComponent_tr_9_td_3_ng_container_4_Template, 2, 0, \"ng-container\", 9);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"width\", 150);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r7.Status == 2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r7.Status == 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r7.Status == 3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r7.Status == 4);\n  }\n}\n\nfunction ProjectProductStatusPerformComponent_tr_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 3);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, ProjectProductStatusPerformComponent_tr_9_td_3_Template, 5, 5, \"td\", 7);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r4.ProductName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", row_r4.ListStage);\n  }\n}\n\nexport let ProjectProductStatusPerformComponent = /*#__PURE__*/(() => {\n  class ProjectProductStatusPerformComponent {\n    constructor(appSetting, router, messageService, checkSpecialCharacter, routeA, titleservice, comboboxService, constant, dateUtils, activeModal, projectProductService, permissionService, paymentService, //#region thaint\n    modalService) {\n      this.appSetting = appSetting;\n      this.router = router;\n      this.messageService = messageService;\n      this.checkSpecialCharacter = checkSpecialCharacter;\n      this.routeA = routeA;\n      this.titleservice = titleservice;\n      this.comboboxService = comboboxService;\n      this.constant = constant;\n      this.dateUtils = dateUtils;\n      this.activeModal = activeModal;\n      this.projectProductService = projectProductService;\n      this.permissionService = permissionService;\n      this.paymentService = paymentService;\n      this.modalService = modalService;\n      this.ListData = [];\n      this.ListResult = [];\n      this.ListStage = [];\n      this.model = {\n        Id: '',\n        ProjectId: '',\n        ParentId: '',\n        ModuleId: '',\n        ProductId: '',\n        Name: '',\n        StageId: '',\n        StageName: '',\n        StageIndex: '',\n        PlanStatus: '',\n        PlanWeight: '',\n        PlanDoneRatio: ''\n      };\n      this.modelStage = {\n        StageId: '',\n        StageName: '',\n        StageIndex: ''\n      };\n      this.PlanStage = {\n        ProjectProductName: '',\n        ListStage: []\n      };\n      this.ListPlan = [];\n      this.ListPlanResult = [];\n    }\n\n    ngOnInit() {\n      this.getProjectProductStatusPerform();\n    }\n\n    getProjectProductStatusPerform() {\n      this.projectProductService.getProjectProductStatusPerform(this.Id).subscribe(data => {\n        this.ListData = data;\n        this.ListData.forEach(element => {\n          var model = {\n            Id: element.Id,\n            ProjectProductId: element.ProjectProductId,\n            ProjectId: element.ProjectId,\n            ParentId: element.ParentId,\n            ModuleId: element.ModuleId,\n            ProductId: element.ProductId,\n            Name: element.Name,\n            StageId: element.StageId,\n            StageName: element.StageName,\n            StageIndex: element.StageIndex,\n            PlanStatus: element.PlanStatus,\n            PlanWeight: element.PlanWeight,\n            PlanDoneRatio: element.PlanDoneRatio,\n            ListChild: []\n          };\n          this.ListResult.push(model);\n\n          if (element.StageId != null) {\n            var modelStage = {\n              StageId: element.StageId,\n              StageName: element.StageName,\n              StageIndex: element.StageIndex,\n              ListPlan: [],\n              ProjectProductId: '',\n              ProjectId: ''\n            };\n            var count = 0;\n            this.ListStage.forEach(item => {\n              if (item.StageId == modelStage.StageId) {\n                count++;\n              }\n            });\n\n            if (count == 0) {\n              this.ListStage.push(modelStage);\n            }\n          }\n        }); // add project product vào  stage\n\n        this.ListResult.forEach(r => {\n          this.ListResult.forEach(r1 => {\n            if (r1.StageId == null && r1.ParentId == r.Id && r1.ProjectProductId == null) {\n              r.ListChild.push(r1);\n            }\n          });\n        });\n        this.ListResult.forEach(item => {\n          if (item.StageId != null) {\n            this.ListPlan.push(item);\n          }\n        }); //\n\n        this.ListPlan.forEach(item => {\n          var count = 0;\n          this.ListPlanResult.forEach(item1 => {\n            if (item1.ProjectProductId == item.ProjectProductId && item1.ProjectId == item.ProjectId) {\n              count++;\n            }\n          });\n\n          if (count == 0) {\n            var planStage = {\n              ProductName: item.Name,\n              ProjectProductId: item.ProjectProductId,\n              ProjectId: item.ProjectId,\n              ListStage: []\n            }; //\n\n            this.ListStage.forEach(plan => {\n              var modelStage = {\n                StageId: plan.StageId,\n                StageName: plan.StageName,\n                StageIndex: plan.StageIndex,\n                ListPlan: [],\n                ProjectProductId: item.ProjectProductId,\n                ProjectId: item.ProjectId,\n                Status: 4\n              };\n              planStage.ListStage.push(modelStage);\n            }); //\n\n            this.ListPlanResult.push(planStage);\n          }\n        }); //\n\n        this.ListPlanResult.forEach(element => {\n          element.ListStage.forEach(item => {\n            this.ListPlan.forEach(item1 => {\n              if (item1.ProjectProductId == item.ProjectProductId && item1.ProjectId == item.ProjectId) {\n                if (item1.StageId == item.StageId) {\n                  if (item1.ListChild.length > 0) {\n                    item.ListPlan = item1.ListChild;\n                    item.IsParent = true;\n                    item.PlanParent = item1;\n                    var open = 1;\n                    var countOpen = 0;\n                    var onGoing = 2;\n                    var countOnGoing = 0;\n                    var close = 3;\n                    var countClose = 0;\n                    var stop = 4;\n                    var countStop = 0;\n                    item1.ListChild.forEach(child => {\n                      if (child.PlanStatus == open) {\n                        countOpen++;\n                      } else if (child.PlanStatus == onGoing) {\n                        countOnGoing++;\n                      } else if (child.PlanStatus == close) {\n                        countClose++;\n                      } else if (child.PlanStatus == stop) {\n                        countStop++;\n                      }\n                    });\n\n                    if (countOpen == item1.ListChild.length) {\n                      item.Status = open;\n                    } else if (countOnGoing == item1.ListChild.length) {\n                      item.Status = onGoing;\n                    } else if (countClose == item1.ListChild.length) {\n                      item.Status = close;\n                    } else if (countStop == item1.ListChild.length) {\n                      item.Status = stop;\n                    } else {\n                      item.Status = onGoing;\n                    }\n                  } else {\n                    item.ListPlan.push(item1);\n                    item.IsParent = false;\n                    item.Status = item1.PlanStatus;\n                  }\n                }\n              }\n            });\n          });\n        }); // tính done ratio\n\n        this.ListPlanResult.forEach(element => {\n          element.ListStage.forEach(stage => {\n            var totalDoneRatio = 0;\n            var totalWeight = 0;\n            stage.ListPlan.forEach(plan => {\n              totalDoneRatio = totalDoneRatio + plan.PlanWeight * plan.PlanDoneRatio;\n              totalWeight = totalWeight + plan.PlanWeight;\n            });\n\n            if (totalWeight != 0) {\n              stage.DoneRatio = totalDoneRatio / totalWeight;\n            } else {\n              stage.DoneRatio = 0;\n            }\n          });\n        });\n      }, error => {\n        this.messageService.showError(error);\n      });\n    }\n\n  }\n\n  ProjectProductStatusPerformComponent.ɵfac = function ProjectProductStatusPerformComponent_Factory(t) {\n    return new (t || ProjectProductStatusPerformComponent)(i0.ɵɵdirectiveInject(i1.AppSetting), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i3.CheckSpecialCharacter), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i4.Title), i0.ɵɵdirectiveInject(i1.ComboboxService), i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i1.DateUtils), i0.ɵɵdirectiveInject(i5.NgbActiveModal), i0.ɵɵdirectiveInject(i6.ProjectProductService), i0.ɵɵdirectiveInject(i1.PermissionService), i0.ɵɵdirectiveInject(i7.ProjectPaymentService), i0.ɵɵdirectiveInject(i5.NgbModal));\n  };\n\n  ProjectProductStatusPerformComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ProjectProductStatusPerformComponent,\n    selectors: [[\"app-project-product-status-perform\"]],\n    inputs: {\n      Id: \"Id\"\n    },\n    decls: 10,\n    vars: 5,\n    consts: [[1, \"col-xl-12\", \"col-lg-12\", \"col-md-12\", \"col-sm-12\"], [2, \"height\", \"auto\", \"width\", \"100%\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"word-wrap\", \"break-word\"], [\"min-width\", \"200px\", 1, \"text-center\"], [\"colspan\", \"1\", \"class\", \"text-center \", 3, \"width\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngFor\", \"ngForOf\"], [\"colspan\", \"1\", 1, \"text-center\", 3, \"width\"], [\"class\", \"text-center\", 3, \"width\", 4, \"ngFor\", \"ngForOf\"], [1, \"text-center\", 3, \"width\"], [4, \"ngIf\"], [1, \"progress\"], [1, \"progress-bar\", \"bg-warning\"]],\n    template: function ProjectProductStatusPerformComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"perfect-scrollbar\", 1)(2, \"table\", 2)(3, \"thead\")(4, \"tr\")(5, \"th\", 3);\n        i0.ɵɵtext(6, \"T\\u00EAn s\\u1EA3n ph\\u1EA9m\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(7, ProjectProductStatusPerformComponent_th_7_Template, 2, 2, \"th\", 4);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"tbody\");\n        i0.ɵɵtemplate(9, ProjectProductStatusPerformComponent_tr_9_Template, 4, 2, \"tr\", 5);\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"config\", ctx.constant.ScrollConfig);\n        i0.ɵɵadvance(1);\n        i0.ɵɵstyleProp(\"min-width\", 200 + ctx.ListStage.length * 150 + \"px\");\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngForOf\", ctx.ListStage);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.ListPlanResult);\n      }\n    }\n  });\n  return ProjectProductStatusPerformComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}