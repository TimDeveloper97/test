{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport * as moment from 'moment';\nimport { ViewPlanDetailComponent } from '../view-plan-detail/view-plan-detail.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i3 from \"../../service/plan.service\";\nconst _c0 = [\"scrollWorkingTime\"];\nconst _c1 = [\"scrollWorkingTimeHeader\"];\n\nfunction WorkingTimeComponent_th_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r7 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", row_r7 != 1 ? \"T\" + row_r7 : \"CN\", \" \");\n  }\n}\n\nfunction WorkingTimeComponent_th_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 31);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r9 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, item_r9.DateTime, \"dd\"), \"\");\n  }\n}\n\nfunction WorkingTimeComponent_tr_44_td_9_a_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 38);\n    i0.ɵɵlistener(\"click\", function WorkingTimeComponent_tr_44_td_9_a_1_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const item_r14 = i0.ɵɵnextContext().$implicit;\n      const row_r11 = i0.ɵɵnextContext().$implicit;\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.loadParam(item_r14, row_r11.EmployeeCode));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r14.EstimateTime, \"\");\n  }\n}\n\nconst _c2 = function (a0, a1, a2, a3) {\n  return {\n    \"warning_time\": a0,\n    \"warning_time1\": a1,\n    \"holiday\": a2,\n    \"warning_time2\": a3\n  };\n};\n\nfunction WorkingTimeComponent_tr_44_td_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 36);\n    i0.ɵɵtemplate(1, WorkingTimeComponent_tr_44_td_9_a_1_Template, 2, 1, \"a\", 37);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r14 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction4(2, _c2, item_r14.EstimateTime == 8, item_r14.EstimateTime > 8, item_r14.IsHoliday, item_r14.EstimateTime > 0 && item_r14.EstimateTime < 8));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r14.EstimateTime != 0);\n  }\n}\n\nfunction WorkingTimeComponent_tr_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 32);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 33);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 34);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 34);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, WorkingTimeComponent_tr_44_td_9_Template, 2, 7, \"td\", 35);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r11 = ctx.$implicit;\n    const i_r12 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r12 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r11.EmployeeCode);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r11.EmployeeName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r11.WorkType);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", row_r11.ListWorkingTime);\n  }\n}\n\nexport let WorkingTimeComponent = /*#__PURE__*/(() => {\n  class WorkingTimeComponent {\n    constructor(appSetting, messageService, modalService, config, service, constant, combobox, dateUtils) {\n      this.appSetting = appSetting;\n      this.messageService = messageService;\n      this.modalService = modalService;\n      this.config = config;\n      this.service = service;\n      this.constant = constant;\n      this.combobox = combobox;\n      this.dateUtils = dateUtils;\n      this.StartIndex = 0;\n      this.listData = [];\n      this.searchModel = {\n        DepartmentId: '',\n        SBUId: '',\n        NameCode: '',\n        DateToV: this.dateUtils.getFiscalYearEnd(),\n        DateFromV: this.dateUtils.getFiscalYearStart(),\n        WorkType: ''\n      };\n      this.dateStartV = this.dateUtils.getDateNowStart();\n      this.dateEndV = this.dateUtils.getDateNowEnd();\n      this.searchOptions = {\n        Placeholder: 'Tìm kiếm theo mã hoặc tên nhân viên ...',\n        FieldContentName: 'NameCode',\n        Items: [{\n          Name: 'SBU',\n          FieldName: 'SBUId',\n          Placeholder: 'SBU',\n          Type: 'dropdown',\n          DataType: this.constant.SearchDataType.SBU,\n          Columns: [{\n            Name: 'Code',\n            Title: 'Mã SBU'\n          }, {\n            Name: 'Name',\n            Title: 'Tên SBU'\n          }],\n          DisplayName: 'Name',\n          ValueName: 'Id',\n          IsRelation: true,\n          Permission: ['F060802'],\n          RelationIndexTo: 1\n        }, {\n          Name: 'Phòng ban',\n          FieldName: 'DepartmentId',\n          Placeholder: 'Phòng ban',\n          Type: 'dropdown',\n          DataType: this.constant.SearchDataType.Department,\n          Columns: [{\n            Name: 'Code',\n            Title: 'Mã phòng ban'\n          }, {\n            Name: 'Name',\n            Title: 'Tên phòng ban'\n          }],\n          DisplayName: 'Name',\n          ValueName: 'Id',\n          Permission: ['F060802'],\n          RelationIndexFrom: 0\n        }, {\n          Name: 'Vị trí công việc',\n          FieldName: 'WorkType',\n          Placeholder: 'Vị trí công việc',\n          Type: 'dropdown',\n          DataType: this.constant.SearchDataType.WorkType,\n          Columns: [{\n            Name: 'Name',\n            Title: 'Vị trí công việc'\n          }],\n          DisplayName: 'Name',\n          ValueName: 'Id'\n        }]\n      };\n      this.listTem = [];\n      this.listDays = [];\n      this.daysOfMonth = [];\n      this.height = 100;\n      this.isTrue = 0;\n      this.selectIndex = -1;\n      this.listTemp = [];\n    }\n\n    ngOnInit() {\n      this.height = window.innerHeight - 320;\n      this.searchModel.PlanDate = new Date();\n      this.appSetting.PageTitle = \"Thời gian làm việc\";\n      let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n      if (currentUser) {\n        this.searchModel.SBUId = currentUser.sbuId;\n        this.searchModel.DepartmentId = currentUser.departmentId;\n      }\n\n      this.searchWorkingTime();\n    }\n\n    ngAfterViewInit() {\n      this.scrollWorkingTime.nativeElement.addEventListener('ps-scroll-x', event => {\n        this.scrollWorkingTimeHeader.nativeElement.scrollLeft = event.target.scrollLeft;\n      }, true);\n    }\n\n    ngOnDestroy() {\n      this.scrollWorkingTime.nativeElement.removeEventListener('ps-scroll-x', null);\n    }\n\n    searchWorkingTime() {\n      if (this.searchModel.DateFromV != null) {\n        this.searchModel.DateFrom = this.dateUtils.convertObjectToDate(this.searchModel.DateFromV);\n      }\n\n      if (this.searchModel.DateFromV == null) {\n        this.searchModel.DateFrom = null;\n      }\n\n      if (this.searchModel.DateToV != null) {\n        this.searchModel.DateTo = this.dateUtils.convertObjectToDate(this.searchModel.DateToV);\n      }\n\n      if (this.searchModel.DateToV == null) {\n        this.searchModel.DateTo = null;\n      }\n\n      if (this.dateStartV != null) {\n        this.searchModel.DateStart = this.dateUtils.convertObjectToDate(this.dateStartV);\n      } else {\n        this.searchModel.DateStart = null;\n      }\n\n      if (this.dateEndV != null) {\n        this.searchModel.DateEnd = this.dateUtils.convertObjectToDate(this.dateEndV);\n      } else {\n        this.searchModel.DateEnd = null;\n      }\n\n      this.service.searchWorkingTime(this.searchModel).subscribe(data => {\n        if (data) {\n          this.listData = data.ListResult;\n          this.listDays = data.DayofMonths;\n          this.listTem = data.DayOfWeeks;\n          this.daysOfMonth = data.holiday;\n          this.listData.forEach(element => {\n            element.ListWorkingTime.forEach(item => {\n              if (item.IsHoliday) {\n                item.EstimateTime = null;\n              }\n            });\n          });\n        }\n      }, error => {\n        this.messageService.showError(error);\n      });\n    }\n\n    changeDate() {\n      var dateEnd = moment(this.dateStartV).add(-1, \"month\").add(1, \"month\");\n      var dateNow = new Date();\n      var dateNext = new Date(this.dateStartV.year, this.dateStartV.month, 0);\n\n      if (this.dateStartV.day == 1) {\n        this.dateEndV = {\n          year: dateEnd.year(),\n          month: dateEnd.month(),\n          day: dateNext.getDate()\n        };\n      } else {\n        var monthday = new Date(this.dateStartV.year, this.dateStartV.month + 1, 0);\n\n        if (this.dateStartV.day == 31) {\n          this.dateEndV = {\n            year: monthday.getFullYear(),\n            month: monthday.getMonth() + 1,\n            day: monthday.getDate()\n          };\n        } else {\n          this.dateEndV = {\n            year: dateEnd.year(),\n            month: dateEnd.month() + 1,\n            day: dateEnd.date()\n          };\n        }\n      }\n\n      this.searchWorkingTime();\n    }\n\n    loadParam(event, EmployeeCode) {\n      let activeModal = this.modalService.open(ViewPlanDetailComponent, {\n        container: 'body',\n        windowClass: 'view-plan-model',\n        backdrop: 'static'\n      });\n      activeModal.componentInstance.listPlanId = event.PlanId;\n      activeModal.componentInstance.EmployeeCode = EmployeeCode;\n      activeModal.result.then(result => {\n        if (result) {\n          this.searchWorkingTime();\n        }\n      }, reason => {});\n    }\n\n  }\n\n  WorkingTimeComponent.ɵfac = function WorkingTimeComponent_Factory(t) {\n    return new (t || WorkingTimeComponent)(i0.ɵɵdirectiveInject(i1.AppSetting), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i2.NgbModal), i0.ɵɵdirectiveInject(i1.Configuration), i0.ɵɵdirectiveInject(i3.PlanService), i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i1.ComboboxService), i0.ɵɵdirectiveInject(i1.DateUtils));\n  };\n\n  WorkingTimeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: WorkingTimeComponent,\n    selectors: [[\"app-working-time\"]],\n    viewQuery: function WorkingTimeComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.scrollWorkingTime = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.scrollWorkingTimeHeader = _t.first);\n      }\n    },\n    decls: 45,\n    vars: 10,\n    consts: [[1, \"content-wrapper\"], [1, \"box\"], [1, \"content-body\", \"padding-15\"], [1, \"row\"], [1, \"col-xl-8\", \"col-lg-12\", \"col-md-8\", \"col-sm-12\"], [\"name\", \"searchModel\", 3, \"options\", \"ngModel\", \"optionsChange\", \"ngModelChange\", \"change\"], [1, \"col-xl-4\", \"col-md-4\", \"col-sm-12\", \"col-lg-4\", \"text-right\"], [1, \"datetime\"], [1, \"input-group\"], [\"ngbDatepicker\", \"\", \"name\", \"option.FieldNameFrom\", \"placeholder\", \"T\\u1EEB ng\\u00E0y\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\", \"click\"], [\"dateFrom\", \"ngbDatepicker\"], [1, \"input-group-append\"], [\"name\", \"DateOfBirth\", 1, \"dtp-icon\", 3, \"click\"], [1, \"far\", \"fa-calendar-alt\", 2, \"color\", \"#999\"], [\"name\", \"option.FieldNameTo\", \"ngbDatepicker\", \"\", \"placeholder\", \"\\u0110\\u1EBFn ng\\u00E0y\", \"disabled\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\", \"click\"], [\"dateTo\", \"ngbDatepicker\"], [1, \"row\", \"mt-3\"], [\"scrollWorkingTime\", \"\"], [1, \"col-xl-12\", \"col-md-12\", \"col-sm-12\", \"col-lg-12\"], [2, \"overflow-x\", \"auto\", \"overflow\", \"hidden\"], [\"scrollWorkingTimeHeader\", \"\"], [1, \"table\", \"table-bordered\", \"table-fixed\", \"mb-0\", 2, \"min-width\", \"1690px\"], [\"rowspan\", \"2\", \"width\", \"50px\", 1, \"text-center\"], [\"rowspan\", \"2\", \"width\", \"100px\", 1, \"text-center\"], [\"rowspan\", \"2\", \"width\", \"150px\", 1, \"text-center\"], [\"min-width\", \"30px\", \"class\", \"text-center ListTem\", 4, \"ngFor\", \"ngForOf\"], [\"min-width\", \"30px\", \"class\", \"text-center\", 4, \"ngFor\", \"ngForOf\"], [2, \"width\", \"100%\", 3, \"config\"], [1, \"table\", \"table-bordered\", \"table-fixed\", \"table-hover\", 2, \"min-width\", \"1690px\"], [4, \"ngFor\", \"ngForOf\"], [\"min-width\", \"30px\", 1, \"text-center\", \"ListTem\"], [\"min-width\", \"30px\", 1, \"text-center\"], [\"width\", \"50px\", 1, \"text-center\"], [\"width\", \"100px\"], [\"width\", \"150px\"], [\"min-width\", \"30px\", \"class\", \"text-center text-nowrap\", 3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [\"min-width\", \"30px\", 1, \"text-center\", \"text-nowrap\", 3, \"ngClass\"], [\"href\", \" javascript:void(0)\", 3, \"click\", 4, \"ngIf\"], [\"href\", \" javascript:void(0)\", 3, \"click\"]],\n    template: function WorkingTimeComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r22 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"section\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"nts-search-bar\", 5);\n        i0.ɵɵlistener(\"optionsChange\", function WorkingTimeComponent_Template_nts_search_bar_optionsChange_5_listener($event) {\n          return ctx.searchOptions = $event;\n        })(\"ngModelChange\", function WorkingTimeComponent_Template_nts_search_bar_ngModelChange_5_listener($event) {\n          return ctx.searchModel = $event;\n        })(\"change\", function WorkingTimeComponent_Template_nts_search_bar_change_5_listener() {\n          return ctx.searchWorkingTime();\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(6, \"div\", 6)(7, \"div\", 7)(8, \"div\", 8)(9, \"input\", 9, 10);\n        i0.ɵɵlistener(\"ngModelChange\", function WorkingTimeComponent_Template_input_ngModelChange_9_listener($event) {\n          return ctx.dateStartV = $event;\n        })(\"click\", function WorkingTimeComponent_Template_input_click_9_listener($event) {\n          i0.ɵɵrestoreView(_r22);\n\n          const _r0 = i0.ɵɵreference(10);\n\n          _r0.toggle();\n\n          return i0.ɵɵresetView($event.stopPropagation());\n        })(\"ngModelChange\", function WorkingTimeComponent_Template_input_ngModelChange_9_listener() {\n          return ctx.changeDate();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"div\", 11)(12, \"span\", 12);\n        i0.ɵɵlistener(\"click\", function WorkingTimeComponent_Template_span_click_12_listener() {\n          i0.ɵɵrestoreView(_r22);\n\n          const _r0 = i0.ɵɵreference(10);\n\n          return i0.ɵɵresetView(_r0.toggle());\n        });\n        i0.ɵɵelement(13, \"i\", 13);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵtext(14, \" \\u00A0 \\u00A0 \");\n        i0.ɵɵelementStart(15, \"div\", 7)(16, \"div\", 8)(17, \"input\", 14, 15);\n        i0.ɵɵlistener(\"ngModelChange\", function WorkingTimeComponent_Template_input_ngModelChange_17_listener($event) {\n          return ctx.dateEndV = $event;\n        })(\"click\", function WorkingTimeComponent_Template_input_click_17_listener($event) {\n          i0.ɵɵrestoreView(_r22);\n\n          const _r1 = i0.ɵɵreference(18);\n\n          _r1.toggle();\n\n          return i0.ɵɵresetView($event.stopPropagation());\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"div\", 11)(20, \"span\", 12);\n        i0.ɵɵlistener(\"click\", function WorkingTimeComponent_Template_span_click_20_listener() {\n          i0.ɵɵrestoreView(_r22);\n\n          const _r1 = i0.ɵɵreference(18);\n\n          return i0.ɵɵresetView(_r1.toggle());\n        });\n        i0.ɵɵelement(21, \"i\", 13);\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵelementStart(22, \"div\", 16, 17)(24, \"div\", 18)(25, \"div\", 19, 20)(27, \"table\", 21)(28, \"thead\")(29, \"tr\")(30, \"th\", 22);\n        i0.ɵɵtext(31, \"STT\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"th\", 23);\n        i0.ɵɵtext(33, \"M\\u00E3 nh\\u00E2n vi\\u00EAn\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"th\", 24);\n        i0.ɵɵtext(35, \"T\\u00EAn nh\\u00E2n vi\\u00EAn\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"th\", 24);\n        i0.ɵɵtext(37, \"V\\u1ECB tr\\u00ED c\\u00F4ng vi\\u1EC7c\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(38, WorkingTimeComponent_th_38_Template, 2, 1, \"th\", 25);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(39, \"tr\");\n        i0.ɵɵtemplate(40, WorkingTimeComponent_th_40_Template, 3, 4, \"th\", 26);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(41, \"perfect-scrollbar\", 27)(42, \"table\", 28)(43, \"tbody\");\n        i0.ɵɵtemplate(44, WorkingTimeComponent_tr_44_Template, 10, 5, \"tr\", 29);\n        i0.ɵɵelementEnd()()()()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"options\", ctx.searchOptions)(\"ngModel\", ctx.searchModel);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.dateStartV);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngModel\", ctx.dateEndV);\n        i0.ɵɵadvance(21);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listTem);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listDays);\n        i0.ɵɵadvance(1);\n        i0.ɵɵstyleProp(\"height\", ctx.height, \"px\");\n        i0.ɵɵproperty(\"config\", ctx.constant.ScrollConfig);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listData);\n      }\n    },\n    styles: [\"app-working-time .dayOfWeek{background-color:#deb887}app-working-time .warning_time{background-color:#a6fab4}app-working-time .warning_time1{background-color:#f80b0b}app-working-time .warning_time1 a{color:#fff}app-working-time .warning_time2{background-color:#ff0}app-working-time .holiday{background-color:#8a8a8a71}app-working-time .datetime{text-align:center;width:100px;display:inline-block}\\n\"],\n    encapsulation: 2\n  });\n  return WorkingTimeComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}