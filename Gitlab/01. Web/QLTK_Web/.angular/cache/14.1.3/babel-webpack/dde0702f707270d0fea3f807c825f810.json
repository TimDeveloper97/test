{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { ElementRef } from '@angular/core';\nimport { BroadcastEventListener } from 'src/app/signalr/broadcast.event.listener';\nimport { BlockUI } from 'ng-block-ui';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"src/app/signalR/signal-r.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"ngx-perfect-scrollbar\";\nimport * as i5 from \"devextreme-angular/core\";\nimport * as i6 from \"devextreme-angular/ui/context-menu\";\nconst _c0 = [\"scrollHeaderOne\"];\n\nfunction TestDesignCadComponent_tr_23_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"td\", 16);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 17);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 17);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 18);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\", 19);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    const i_r6 = ctx_r9.index;\n    const row_r5 = ctx_r9.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r6 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.Name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.NameVT);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.Type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.PathLocal);\n  }\n}\n\nfunction TestDesignCadComponent_tr_23_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"td\", 6);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 20);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 20);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 21);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\", 22);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext();\n    const i_r6 = ctx_r10.index;\n    const row_r5 = ctx_r10.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r6 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.Name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.NameVT);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.Type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.PathLocal);\n  }\n}\n\nfunction TestDesignCadComponent_tr_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵtemplate(1, TestDesignCadComponent_tr_23_ng_container_1_Template, 11, 5, \"ng-container\", 15);\n    i0.ɵɵtemplate(2, TestDesignCadComponent_tr_23_ng_container_2_Template, 11, 5, \"ng-container\", 15);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const row_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", row_r5.TypeColor == \"0\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !row_r5.TypeColor);\n  }\n}\n\nfunction TestDesignCadComponent_div_25_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 25);\n  }\n}\n\nfunction TestDesignCadComponent_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵelement(2, \"span\", 23);\n    i0.ɵɵtemplate(3, TestDesignCadComponent_div_25_span_3_Template, 1, 0, \"span\", 24);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const e_r11 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", e_r11.icon);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", e_r11.items);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", e_r11.text, \" \");\n  }\n}\n\nfunction TestDesignCadComponent_ng_container_26_tr_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 28);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 30);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const row_r14 = ctx.$implicit;\n    const i_r15 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r15 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r14);\n  }\n}\n\nfunction TestDesignCadComponent_ng_container_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 0)(2, \"div\", 1)(3, \"label\", 2);\n    i0.ɵɵtext(4, \"Danh s\\u00E1ch l\\u1ED7i \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerStart(5);\n    i0.ɵɵelementStart(6, \"perfect-scrollbar\", 26)(7, \"table\", 27)(8, \"thead\")(9, \"tr\")(10, \"th\", 28);\n    i0.ɵɵtext(11, \"STT\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\", 29);\n    i0.ɵɵtext(13, \"T\\u00EAn l\\u1ED7i\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"tbody\");\n    i0.ɵɵtemplate(15, TestDesignCadComponent_ng_container_26_tr_15_Template, 5, 2, \"tr\", 12);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"config\", ctx_r3.constant.ScrollConfig);\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.listErrorCheckCAD);\n  }\n}\n\nfunction TestDesignCadComponent_ng_container_27_tr_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 28);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 30);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const row_r17 = ctx.$implicit;\n    const i_r18 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r18 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r17);\n  }\n}\n\nfunction TestDesignCadComponent_ng_container_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 0)(2, \"div\", 31)(3, \"label\", 2);\n    i0.ɵɵtext(4, \"Th\\u00F4ng b\\u00E1o \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerStart(5);\n    i0.ɵɵelementStart(6, \"perfect-scrollbar\", 26)(7, \"table\", 27)(8, \"thead\")(9, \"tr\")(10, \"th\", 28);\n    i0.ɵɵtext(11, \"STT\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\", 29);\n    i0.ɵɵtext(13, \"Th\\u00F4ng b\\u00E1o\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"tbody\");\n    i0.ɵɵtemplate(15, TestDesignCadComponent_ng_container_27_tr_15_Template, 5, 2, \"tr\", 12);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"config\", ctx_r4.constant.ScrollConfig);\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.listSuccess);\n  }\n}\n\nexport class TestDesignCadComponent {\n  constructor(constant, signalRService, messageService, config) {\n    this.constant = constant;\n    this.signalRService = signalRService;\n    this.messageService = messageService;\n    this.config = config;\n    this.items = [];\n    this.modelTest = {\n      ApiUrl: '',\n      PathFile: '',\n      SelectedPath: '',\n      ModuleCode: '',\n      List3D: [],\n      ListMaterialDB: [],\n      ListModuleDesignDocument: [],\n      ListRawMaterial: [],\n      ListModuleError: [],\n      ListConvertUnit: [],\n      ListDesignStructure: [],\n      ListDesignStructureFile: [],\n      Module: []\n    };\n    this.errorCAD = new BroadcastEventListener('listErrorCAD');\n    this.downloadAllCAD = new BroadcastEventListener('downloadAllCAD');\n    this.listErrorCAD = [];\n    this.listErrorCheckCAD = [];\n    this.listSuccess = [];\n    this.listFile = [];\n    this.items = [{\n      Id: 1,\n      text: 'Xóa file thừa',\n      icon: 'fas fa-times text-danger'\n    }];\n  }\n\n  ngOnDestroy() {\n    window.removeEventListener('ps-scroll-x', null);\n  }\n\n  ngOnInit() {\n    // if (this.listErrorCheckCAD.length == 0) {\n    //   // this.messageService.showMessage(\"Thư mục CAD đã chuẩn!\");\n    //   this.listSuccess.push(\"Thư mục CAD đã chuẩn\");\n    // }\n    window.addEventListener('ps-scroll-x', event => {\n      this.scrollHeaderOne.nativeElement.scrollLeft = event.target.scrollLeft;\n    }, true);\n    this.modelTest.PathFile = this.pathDMVT;\n    this.modelTest.ModuleCode = this.moduleCode;\n    this.modelTest.SelectedPath = this.selectedPath;\n    this.modelTest.ApiUrl = this.config.ServerApi;\n    this.signalRService.listen(this.errorCAD, false);\n    this.notiSub = this.errorCAD.subscribe(data => {\n      if (data) {\n        if (data.StatusCode == 1) {\n          this.listErrorCAD = data.Data;\n\n          if (this.listErrorCAD.length == 0) {\n            this.messageService.showMessage(\"Thư mục CAD thiết kế đã chuẩn\");\n          }\n        } else {\n          this.messageService.showMessage(data.Message);\n        }\n      }\n\n      this.blockUI.stop();\n    });\n    this.signalRService.listen(this.downloadAllCAD, false);\n    this.notiSub = this.downloadAllCAD.subscribe(data => {\n      if (data) {\n        if (data.StatusCode == 1) {\n          this.messageService.showSuccess('Tải dữ liệu thành công!');\n        } else {\n          this.messageService.showMessage(data.Message);\n        }\n      }\n\n      this.blockUI.stop();\n    });\n  }\n\n  checkDesignCAD() {\n    this.modelTest.PathFile = this.pathDMVT;\n    this.modelTest.ModuleCode = this.moduleCode;\n    this.modelTest.SelectedPath = this.selectedPath;\n    this.modelTest.ApiUrl = this.config.ServerApi;\n    let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n    if (currentUser && currentUser.access_token) {\n      this.modelTest.Token = currentUser.access_token;\n    }\n\n    this.signalRService.invoke('CheckDesignCAD', this.modelTest).subscribe(data => {\n      if (data) {\n        this.blockUI.start();\n      } else {\n        this.messageService.showMessage(\"Không kết nối được service\");\n      }\n    });\n  }\n\n  downloadAll() {\n    let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n    if (currentUser && currentUser.access_token) {\n      this.modelTest.Token = currentUser.access_token;\n    }\n\n    this.signalRService.invoke('DownLoadAllCAD', this.modelTest).subscribe(data => {\n      if (data) {\n        this.blockUI.start();\n      } else {\n        this.messageService.showMessage(\"Không kết nối được service\");\n      }\n    });\n  }\n\n  itemClick(e) {\n    if (e.itemData.Id == 1) {\n      this.deleteLists();\n    }\n  }\n\n  deleteLists() {\n    this.messageService.showConfirm(\"Bạn có chắc muốn xoá các file thừa này không?\").then(data => {\n      this.listErrorCAD.forEach(element => {\n        if (element.Type == \"Thừa file CAD\") {\n          this.listFile.push(element.PathLocal);\n        }\n      });\n      this.signalRService.invoke('DeleteListFile', this.listFile).subscribe(data => {\n        if (data) {\n          this.blockUI.start();\n        } else {\n          this.messageService.showMessage(\"Không kết nối được service\");\n        }\n      });\n    }, error => {});\n  }\n\n}\n\nTestDesignCadComponent.ɵfac = function TestDesignCadComponent_Factory(t) {\n  return new (t || TestDesignCadComponent)(i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i2.SignalRService), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i1.Configuration));\n};\n\nTestDesignCadComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: TestDesignCadComponent,\n  selectors: [[\"app-test-design-cad\"]],\n  viewQuery: function TestDesignCadComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.scrollHeaderOne = _t.first);\n    }\n  },\n  inputs: {\n    pathDMVT: \"pathDMVT\",\n    moduleCode: \"moduleCode\",\n    txtPathSC: \"txtPathSC\",\n    selectedPath: \"selectedPath\",\n    isDesignCADError: \"isDesignCADError\",\n    listErrorCAD: \"listErrorCAD\",\n    listErrorCheckCAD: \"listErrorCheckCAD\"\n  },\n  decls: 28,\n  vars: 7,\n  consts: [[1, \"row\"], [1, \"col-md-12\", \"col-sm-12\", \"col-lg-12\", \"col-lg-12\", \"col-xl-12\"], [1, \"form-label\"], [2, \"height\", \"auto\", \"width\", \"100%\", \"overflow\", \"hidden\"], [\"scrollHeaderOne\", \"\"], [1, \"table\", \"table-bordered\", \"mb-0\", 2, \"word-wrap\", \"break-word\", \"min-width\", \"1170px\"], [\"width\", \"70px\", 1, \"text-center\"], [\"width\", \"200px\", 1, \"text-center\"], [\"width\", \"500px\", 1, \"text-center\"], [\"min-width\", \"200px\", 1, \"text-center\"], [\"id\", \"caderror\", 2, \"height\", \"500px\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"min-width\", \"1170px\"], [4, \"ngFor\", \"ngForOf\"], [\"keyExpr\", \"Id\", \"target\", \"#caderror\", 3, \"dataSource\", \"width\", \"onItemClick\"], [4, \"dxTemplate\", \"dxTemplateOf\"], [4, \"ngIf\"], [\"width\", \"70px\", 1, \"text-center\", 2, \"background-color\", \"yellow\"], [\"width\", \"200px\", 2, \"background-color\", \"yellow\"], [\"width\", \"500px\", 2, \"background-color\", \"yellow\"], [\"min-width\", \"200px\", 2, \"background-color\", \"yellow\"], [\"width\", \"200px\"], [\"width\", \"500px\"], [\"min-width\", \"200px\"], [3, \"ngClass\"], [\"class\", \"dx-icon-spinright\", 4, \"ngIf\"], [1, \"dx-icon-spinright\"], [2, \"height\", \"500px\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"min-width\", \"650px\"], [\"width\", \"100px\", 1, \"text-center\"], [\"min-width\", \"150px\", 1, \"text-center\"], [\"min-width\", \"500px\"], [1, \"col-md-12\", \"col-sm-12\", \"col-lg-12\", \"col-lg-12\", \"col-xl-12\", \"margin-top-20\"]],\n  template: function TestDesignCadComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementContainerStart(0);\n      i0.ɵɵelementStart(1, \"div\", 0)(2, \"div\", 1)(3, \"label\", 2);\n      i0.ɵɵtext(4, \"N\\u1ED9i dung CAD c\\u0169 \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"div\", 3, 4)(7, \"table\", 5)(8, \"thead\")(9, \"tr\")(10, \"th\", 6);\n      i0.ɵɵtext(11, \"STT\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"th\", 7);\n      i0.ɵɵtext(13, \"M\\u00E3 v\\u1EADt t\\u01B0\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(14, \"th\", 7);\n      i0.ɵɵtext(15, \"T\\u00EAn file CAD\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"th\", 8);\n      i0.ɵɵtext(17, \"C\\u1EA3nh b\\u00E1o\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"th\", 9);\n      i0.ɵɵtext(19, \"\\u0110\\u01B0\\u1EDDng d\\u1EABn\");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(20, \"perfect-scrollbar\", 10)(21, \"table\", 11)(22, \"tbody\");\n      i0.ɵɵtemplate(23, TestDesignCadComponent_tr_23_Template, 3, 2, \"tr\", 12);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(24, \"dx-context-menu\", 13);\n      i0.ɵɵlistener(\"onItemClick\", function TestDesignCadComponent_Template_dx_context_menu_onItemClick_24_listener($event) {\n        return ctx.itemClick($event);\n      });\n      i0.ɵɵtemplate(25, TestDesignCadComponent_div_25_Template, 5, 3, \"div\", 14);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵtemplate(26, TestDesignCadComponent_ng_container_26_Template, 16, 2, \"ng-container\", 15);\n      i0.ɵɵtemplate(27, TestDesignCadComponent_ng_container_27_Template, 16, 2, \"ng-container\", 15);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(20);\n      i0.ɵɵproperty(\"config\", ctx.constant.ScrollConfig);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngForOf\", ctx.listErrorCAD);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dataSource\", ctx.items)(\"width\", 200);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dxTemplateOf\", \"item\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.listErrorCheckCAD.length > 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.listSuccess.length > 0 && ctx.listErrorCAD.length == 0);\n    }\n  },\n  dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i4.PerfectScrollbarComponent, i5.DxTemplateDirective, i6.DxContextMenuComponent]\n});\n\n__decorate([BlockUI()], TestDesignCadComponent.prototype, \"blockUI\", void 0);","map":null,"metadata":{},"sourceType":"module"}