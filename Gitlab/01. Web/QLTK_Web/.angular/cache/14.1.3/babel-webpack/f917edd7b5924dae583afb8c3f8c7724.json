{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { BroadcastEventListener } from 'src/app/signalr/broadcast.event.listener';\nimport { BlockUI } from 'ng-block-ui';\nimport { ProductChooseFolderUploadModalComponent } from '../product-choose-folder-upload-modal/product-choose-folder-upload-modal.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared\";\nimport * as i2 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i3 from \"src/app/signalR/signal-r.service\";\nimport * as i4 from \"../services/product.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../shared/directives/uipermission.directive\";\nimport * as i7 from \"ngx-perfect-scrollbar\";\nimport * as i8 from \"devextreme-angular/core\";\nimport * as i9 from \"devextreme-angular/ui/context-menu\";\nimport * as i10 from \"devextreme-angular/ui/nested\";\nimport * as i11 from \"devextreme-angular/ui/tree-list\";\n\nfunction ProductTabDesignDocumentComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵelement(2, \"span\", 22);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const e_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", e_r3.icon);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\\u00A0 \", e_r3.text, \" \");\n  }\n}\n\nfunction ProductTabDesignDocumentComponent_button_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ProductTabDesignDocumentComponent_button_16_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.showChooseFolderUpload());\n    });\n    i0.ɵɵelement(1, \"i\", 24);\n    i0.ɵɵtext(2, \" Upload t\\u00E0i li\\u1EC7u \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ProductTabDesignDocumentComponent_tr_36_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 30);\n    i0.ɵɵlistener(\"click\", function ProductTabDesignDocumentComponent_tr_36_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const row_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.downloadFile(row_r6.Id, row_r6.Name, row_r6.ServerPath, row_r6.DesignType));\n    });\n    i0.ɵɵelement(1, \"span\", 31);\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst _c0 = function () {\n  return [\"F030413\"];\n};\n\nfunction ProductTabDesignDocumentComponent_tr_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 17);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 25);\n    i0.ɵɵtemplate(4, ProductTabDesignDocumentComponent_tr_36_button_4_Template, 2, 0, \"button\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 27);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 28);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\", 29);\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 29);\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const row_r6 = ctx.$implicit;\n    const i_r7 = ctx.index;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.startIndex + i_r7);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"appUipermission\", i0.ɵɵpureFunction0(14, _c0));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r6.Name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 6, row_r6.FileSize));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(12, 8, row_r6.CreateDate, \"dd/MM/yyyy hh:mm:ss\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 11, row_r6.UpdateDate, \"dd/MM/yyyy hh:mm:ss\"));\n  }\n}\n\nconst _c1 = function () {\n  return [\"F030412\"];\n};\n\nexport class ProductTabDesignDocumentComponent {\n  constructor(constants, modalService, signalRService, productService, messageService, config, componentService) {\n    this.constants = constants;\n    this.modalService = modalService;\n    this.signalRService = signalRService;\n    this.productService = productService;\n    this.messageService = messageService;\n    this.config = config;\n    this.componentService = componentService;\n    this.onDownload = new BroadcastEventListener('downloadFileProductDesignDocument');\n    this.onDownloadFolder = new BroadcastEventListener('downloadFolderProductDesignDocument');\n    this.startIndex = 1;\n    this.productModel = {\n      ProductId: '',\n      FolderId: '',\n      Path: '',\n      ApiUrl: '',\n      Token: ''\n    };\n    this.ListFolder = [];\n    this.ListFile = [];\n    this.ListDesignDocumentId = [];\n    this.folderHeight = 0;\n    this.items = [{\n      Id: 1,\n      text: 'Download',\n      icon: 'fa fa-arrow-down text-success'\n    }];\n  }\n\n  ngOnInit() {\n    this.folderHeight = window.innerHeight - 140;\n    this.productModel.ProductId = this.Id;\n    this.getListFolder();\n    this.signalRService.listen(this.onDownload, true);\n    this.downloadSub = this.onDownload.subscribe(data => {\n      this.blockUI.stop();\n\n      if (data) {\n        if (data.StatusCode == 2) {\n          this.messageService.showMessage(data.Message);\n        } else {\n          this.messageService.showMessage('Download thành công!');\n        }\n      }\n    });\n    this.signalRService.listen(this.onDownloadFolder, true);\n    this.downloadFolderSub = this.onDownloadFolder.subscribe(data => {\n      this.blockUI.stop();\n\n      if (data) {\n        if (data.StatusCode == 2) {\n          this.messageService.showMessage(data.Message);\n        } else {\n          this.messageService.showMessage('Download thành công!');\n        }\n      }\n    });\n  }\n\n  getListFolder() {\n    this.productService.getListFolderProduct(this.Id).subscribe(data => {\n      if (data) {\n        this.ListFolder = data;\n        console.log(this.ListFolder);\n\n        for (var item of this.ListFolder) {\n          this.ListDesignDocumentId.push(item.Id);\n        }\n      }\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  showChooseFolderUpload() {\n    let activeModal = this.modalService.open(ProductChooseFolderUploadModalComponent, {\n      container: 'body',\n      windowClass: 'product-choose-folder-upload-modal',\n      backdrop: 'static'\n    });\n    activeModal.componentInstance.productId = this.Id;\n    activeModal.result.then(result => {\n      this.getListFolder();\n    }, reason => {});\n  }\n\n  ngOnDestroy() {\n    this.downloadSub.unsubscribe();\n    this.signalRService.stopListening(this.onDownload);\n    this.downloadFolderSub.unsubscribe();\n    this.signalRService.stopListening(this.onDownloadFolder);\n  }\n\n  onSelectionChanged(e) {\n    this.searchFile(e.selectedRowKeys[0]);\n    this.folderId = e.selectedRowKeys[0];\n  }\n\n  searchFile(folderId) {\n    this.productModel.FolderId = folderId;\n    this.productService.getListFileProduct(folderId).subscribe(data => {\n      if (data) {\n        this.ListFile = data;\n      }\n    }, error => {\n      this.messageService.showError(error);\n    });\n  }\n\n  downloadFile(id, name, serverPath, designType) {\n    this.componentService.showChooseFolder(1, 1, this.Id).subscribe(result => {\n      if (result) {\n        var file = {\n          Id: id,\n          Name: name,\n          ServerPath: serverPath,\n          DownloadPath: result,\n          Token: '',\n          ApiUrl: this.config.ServerApi\n        };\n        let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n        if (currentUser && currentUser.access_token) {\n          file.Token = currentUser.access_token;\n        }\n\n        this.signalRService.invoke('DownloadFileProductDesignDocument', file).subscribe(data => {\n          if (data) {\n            this.blockUI.start();\n          } else {\n            this.messageService.showMessage(\"Không kết nối được service\");\n          }\n        });\n      }\n    });\n  }\n\n  itemClick(e) {\n    if (!this.folderId) {\n      this.messageService.showMessage(\"Bạn chưa chọn thư mục cần download!\");\n    } else {\n      this.componentService.showChooseFolder(1, 1, this.Id).subscribe(result => {\n        if (result) {\n          var file = {\n            Id: this.folderId,\n            DownloadPath: result,\n            ObjectId: this.Id,\n            Token: '',\n            ApiUrl: this.config.ServerApi\n          };\n          let currentUser = JSON.parse(localStorage.getItem('qltkcurrentUser'));\n\n          if (currentUser && currentUser.access_token) {\n            file.Token = currentUser.access_token;\n          }\n\n          this.signalRService.invoke('DownloadFolderProductDesignDocument', file).subscribe(data => {\n            if (data) {\n              this.blockUI.start();\n            } else {\n              this.messageService.showMessage(\"Không kết nối được service\");\n            }\n          });\n        }\n      });\n    }\n  }\n\n}\n\nProductTabDesignDocumentComponent.ɵfac = function ProductTabDesignDocumentComponent_Factory(t) {\n  return new (t || ProductTabDesignDocumentComponent)(i0.ɵɵdirectiveInject(i1.Constants), i0.ɵɵdirectiveInject(i2.NgbModal), i0.ɵɵdirectiveInject(i3.SignalRService), i0.ɵɵdirectiveInject(i4.ProductService), i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i1.Configuration), i0.ɵɵdirectiveInject(i1.ComponentService));\n};\n\nProductTabDesignDocumentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProductTabDesignDocumentComponent,\n  selectors: [[\"app-product-tab-design-document\"]],\n  inputs: {\n    Id: \"Id\"\n  },\n  decls: 37,\n  vars: 13,\n  consts: [[1, \"d-flex\"], [1, \"search-left\"], [1, \"row\"], [1, \"col-md-12\", \"col-sm-12\", \"col-lg-12\"], [\"id\", \"folders\", \"keyExpr\", \"Id\", \"parentIdExpr\", \"ParentId\", 3, \"dataSource\", \"showRowLines\", \"showBorders\", \"columnAutoWidth\", \"height\", \"expandedRowKeys\", \"onSelectionChanged\"], [\"mode\", \"single\"], [\"dataField\", \"Name\", \"caption\", \"T\\u00EAn th\\u01B0 m\\u1EE5c\"], [\"keyExpr\", \"Id\", \"target\", \"#folders\", 3, \"dataSource\", \"width\", \"onItemClick\"], [4, \"dxTemplate\", \"dxTemplateOf\"], [1, \"body-right\"], [1, \"row\", \"margin-bottom-10\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-12\"], [1, \"form-label\", 2, \"line-height\", \"35px\"], [1, \"col-lg-6\", \"col-md-6\", \"col-sm-12\", \"text-right\"], [\"type\", \"button\", \"class\", \"btn btn-success\", \"container\", \"body\", 3, \"click\", 4, \"appUipermission\"], [2, \"height\", \"auto\", \"width\", \"100%\", 3, \"config\"], [1, \"table\", \"table-bordered\", 2, \"min-width\", \"690px\"], [\"width\", \"50px\", 1, \"text-center\"], [\"width\", \"100px\", 1, \"text-center\"], [\"min-width\", \"200px\", 1, \"text-center\"], [\"width\", \"120px\", 1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"], [3, \"ngClass\"], [\"type\", \"button\", \"container\", \"body\", 1, \"btn\", \"btn-success\", 3, \"click\"], [1, \"fas\", \"fa-arrow-up\"], [\"width\", \"100px\", 2, \"text-align\", \"center\"], [\"type\", \"button\", \"class\", \"btn btn-xs btn-info\", \"placement\", \"top\", \"ngbTooltip\", \"Download file\", \"container\", \"body\", 3, \"click\", 4, \"appUipermission\"], [\"min-width\", \"200px\"], [\"width\", \"100px\"], [\"width\", \"140px\", 1, \"text-center\"], [\"type\", \"button\", \"placement\", \"top\", \"ngbTooltip\", \"Download file\", \"container\", \"body\", 1, \"btn\", \"btn-xs\", \"btn-info\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"fas\", \"fa-arrow-down\"]],\n  template: function ProductTabDesignDocumentComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"section\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"dx-tree-list\", 4);\n      i0.ɵɵlistener(\"onSelectionChanged\", function ProductTabDesignDocumentComponent_Template_dx_tree_list_onSelectionChanged_4_listener($event) {\n        return ctx.onSelectionChanged($event);\n      });\n      i0.ɵɵelement(5, \"dxo-selection\", 5)(6, \"dxi-column\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"dx-context-menu\", 7);\n      i0.ɵɵlistener(\"onItemClick\", function ProductTabDesignDocumentComponent_Template_dx_context_menu_onItemClick_7_listener($event) {\n        return ctx.itemClick($event);\n      });\n      i0.ɵɵtemplate(8, ProductTabDesignDocumentComponent_div_8_Template, 4, 2, \"div\", 8);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(9, \"section\", 9)(10, \"div\", 10)(11, \"div\", 11)(12, \"label\", 12);\n      i0.ɵɵtext(13, \"Danh s\\u00E1ch t\\u00E0i li\\u1EC7u thi\\u1EBFt k\\u1EBF\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(14, \"\\u00A0 \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"div\", 13);\n      i0.ɵɵtemplate(16, ProductTabDesignDocumentComponent_button_16_Template, 3, 0, \"button\", 14);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(17, \"div\", 2)(18, \"div\", 3)(19, \"perfect-scrollbar\", 15)(20, \"table\", 16)(21, \"thead\")(22, \"tr\")(23, \"th\", 17);\n      i0.ɵɵtext(24, \"STT\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(25, \"th\", 18);\n      i0.ɵɵtext(26, \"X\\u1EED l\\u00FD\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(27, \"th\", 19);\n      i0.ɵɵtext(28, \"T\\u00EAn file\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(29, \"th\", 18);\n      i0.ɵɵtext(30, \"Size (byte)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(31, \"th\", 20);\n      i0.ɵɵtext(32, \"Ng\\u00E0y t\\u1EA3i l\\u00EAn\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(33, \"th\", 20);\n      i0.ɵɵtext(34, \"Ng\\u00E0y update\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(35, \"tbody\");\n      i0.ɵɵtemplate(36, ProductTabDesignDocumentComponent_tr_36_Template, 16, 15, \"tr\", 21);\n      i0.ɵɵelementEnd()()()()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"dataSource\", ctx.ListFolder)(\"showRowLines\", true)(\"showBorders\", true)(\"columnAutoWidth\", true)(\"height\", ctx.folderHeight)(\"expandedRowKeys\", ctx.ListDesignDocumentId);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"dataSource\", ctx.items)(\"width\", 200);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"dxTemplateOf\", \"item\");\n      i0.ɵɵadvance(8);\n      i0.ɵɵproperty(\"appUipermission\", i0.ɵɵpureFunction0(12, _c1));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"config\", ctx.constants.ScrollXConfig);\n      i0.ɵɵadvance(17);\n      i0.ɵɵproperty(\"ngForOf\", ctx.ListFile);\n    }\n  },\n  dependencies: [i5.NgClass, i5.NgForOf, i6.UipermissionDirective, i7.PerfectScrollbarComponent, i2.NgbTooltip, i8.DxTemplateDirective, i9.DxContextMenuComponent, i10.DxiColumnComponent, i10.DxoSelectionComponent, i11.DxTreeListComponent, i5.DecimalPipe, i5.DatePipe],\n  styles: [\"app-product-tab-design-document .search-left{width:20em;float:left;margin-left:0!important;max-width:237px}app-product-tab-design-document .body-right{width:100%;margin-left:15px!important;overflow-x:hidden;background-color:#fff}app-product-tab-design-document .selected{background-color:#0ff}app-product-tab-design-document .page-content{display:flex}\\n\"],\n  encapsulation: 2\n});\n\n__decorate([BlockUI()], ProductTabDesignDocumentComponent.prototype, \"blockUI\", void 0);","map":null,"metadata":{},"sourceType":"module"}